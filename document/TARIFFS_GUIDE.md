# Руководство по настройке тарифов (tariffs.json)

## Описание
Файл `document/tariffs.json` содержит конфигурацию всех доступных тарифов в системе. Определяет цены, функции, условия отображения и кнопки для каждого тарифа.

## Структура файла

### Основные поля

| Поле | Тип | Обязательное | Описание |
|------|-----|---------------|----------|
| `id` | string | ✅ | Уникальный идентификатор тарифа |
| `name` | string | ✅ | Название тарифа (на английском) |
| `price` | string | ✅ | Цена в долларах (например: "$15", "$0") |
| `period` | string | ✅ | Период действия (например: "/mo", "/100 min") |
| `tariff` | string | ✅ | Внутренний ID для логики (должен совпадать с `id`) |
| `buttonText` | string | ✅ | Текст кнопки (на английском) |
| `buttonType` | string | ✅ | Тип кнопки ("standard", "secondary") |
| `disabled` | boolean | ✅ | Доступность тарифа (true/false) |
| `statuses` | array | ❌ | Статусы пользователей, которым доступен тариф |
| `features` | array | ❌ | Список функций тарифа |
| `popular` | boolean | ❌ | Помечает тариф как популярный |
| `popularLabel` | string | ❌ | Лейбл для популярного тарифа |

### Поле `statuses`
Определяет, каким пользователям показывать тариф:

- `[]` (пустой массив) - доступен всем
- `["vip"]` - только пользователям со статусом "vip"
- `["CMO"]` - только пользователям со статусом "CMO"
- `["all"]` - доступен всем (альтернатива пустому массиву)

### Поле `features`
Список функций тарифа:

```json
"features": [
  {
    "text": "Описание функции",
    "included": true
  }
]
```

- `text` - описание функции (на английском)
- `included` - включена ли функция (true/false)

### Поля для популярного тарифа

- `popular: true` - помечает тариф как популярный
- `popularLabel: "Popular"` - лейбл для популярного тарифа (на английском)

## Тексты кнопок

| Текст кнопки | Описание |
|--------------|----------|
| "Current" | Текущий тариф пользователя |
| "Buy" | Купить тариф |
| "Start" | Начать подписку |
| "Free" | Бесплатный тариф |
| "Cancel subscription" | Отменить подписку |

## Типы кнопок

- `"standard"` - стандартная кнопка (обычно для текущего тарифа)
- `"secondary"` - вторичная кнопка (для других тарифов)

## Логика отображения

### Проверка статуса пользователя
1. Система проверяет статус пользователя из базы данных
2. Если статус пользователя не входит в `statuses` - тариф скрывается
3. Если `statuses` пустой или содержит "all" - тариф доступен всем

### Определение текста кнопки
Текст кнопки зависит от текущего тарифа пользователя:

**Для пользователей с тарифом "free":**
- Free тариф → "Current"
- Pay-as-you-go → "Buy"
- Подписки → "Start"

**Для пользователей с тарифом "pay-as-you-go":**
- Free тариф → "Free"
- Pay-as-you-go → "Buy"
- Подписки → "Start"

**Для пользователей с подписками:**
- Free тариф → скрывается
- Pay-as-you-go → "Buy"
- Текущая подписка → "Cancel subscription"
- Другие подписки → "Start"

### Популярный тариф
1. Система ищет тариф с `popular: true` или наличием `popularLabel`
2. Если найден - добавляет `popularLabel: "Popular"` к этому тарифу
3. Если не найден - популярный лейбл не добавляется

## Примеры конфигурации

### Базовый тариф
```json
{
  "id": "basic-plan",
  "name": "Basic Plan",
  "price": "$9",
  "period": "/mo",
  "statuses": [],
  "features": [
    {
      "text": "50 minutes per month",
      "included": true
    },
    {
      "text": "Basic support",
      "included": true
    }
  ],
  "tariff": "basic-plan",
  "buttonText": "Start",
  "buttonType": "secondary",
  "disabled": false
}
```

### Популярный тариф
```json
{
  "id": "premium-plan",
  "name": "Premium Plan",
  "price": "$29",
  "period": "/mo",
  "statuses": [],
  "features": [
    {
      "text": "Unlimited conversations",
      "included": true
    },
    {
      "text": "Priority support",
      "included": true
    }
  ],
  "tariff": "premium-plan",
  "buttonText": "Buy",
  "buttonType": "secondary",
  "popular": true,
  "popularLabel": "Popular",
  "disabled": false
}
```

### Тариф для специальных пользователей
```json
{
  "id": "special-plan",
  "name": "Special Plan",
  "price": "$19",
  "period": "/mo",
  "statuses": ["vip", "premium"],
  "features": [
    {
      "text": "Advanced features",
      "included": true
    },
    {
      "text": "24/7 support",
      "included": true
    }
  ],
  "tariff": "special-plan",
  "buttonText": "Start",
  "buttonType": "secondary",
  "disabled": false
}
```

## Важные замечания

1. **Все тексты должны быть на английском языке** - система не поддерживает автоматический перевод
2. **Поле `tariff` должно совпадать с `id`** - это важно для корректной работы логики
3. **Статусы пользователей** задаются в базе данных и должны соответствовать значениям в `statuses`
4. **Популярный тариф** определяется автоматически по полям `popular` или `popularLabel`
5. **Типы кнопок** влияют на внешний вид в интерфейсе
6. **Поле `disabled`** позволяет временно отключить тариф без удаления из файла

## Статусы пользователей

Доступные статусы в системе:
- `"user"` - обычный пользователь (по умолчанию)
- `"vip"` - VIP пользователь
- `"CMO"` - CMO пользователь

## Обновление тарифов

При изменении файла `tariffs.json`:
1. Изменения применяются немедленно без перезапуска сервера
2. Проверьте корректность JSON синтаксиса
3. Убедитесь, что все обязательные поля заполнены
4. Проверьте соответствие статусов пользователей в базе данных