(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[723],{12:e=>{e.exports={chatContainer:"ChatContainer_chatContainer__pCqLx",footer_slot:"ChatContainer_footer_slot__pEzeo"}},412:e=>{e.exports={action_buttons:"VoiceMessagesChatUI_action_buttons__APf0G",record_button:"VoiceMessagesChatUI_record_button__bUNNd"}},708:e=>{e.exports={chat_wrapper:"ChatWindow_chat_wrapper__5_GGR",chat_window:"ChatWindow_chat_window__2a6p8",initial_message:"ChatWindow_initial_message__ntJUV",info_message:"ChatWindow_info_message__7yyI_"}},1628:e=>{e.exports={modal:"s_modal__gpWQu"}},3076:(e,t,n)=>{"use strict";n.d(t,{AuthPage:()=>u});var r=n(5155),s=n(2115),a=n(7118),o=n(2821),i=n(7423),l=n.n(i),c=n(8984);let u=e=>{let{className:t}=e,{t:n}=(0,c.Bd)(),[i,u]=(0,s.useState)("login"),[d,h]=(0,s.useState)(!1),[m,g]=(0,s.useState)(!1),p=e=>{e.preventDefault(),h(!1),g(!1),"login"===i?h(!0):(g(!0),setTimeout(()=>{u("login"),g(!1)},2e3))},_=e=>{alert("".concat(e," авторизация (демо)"))};return(0,r.jsx)("div",{className:(0,o.A)(l().page,t),children:(0,r.jsx)("section",{className:l().authSection,children:(0,r.jsx)(a.mc,{children:(0,r.jsx)("div",{className:l().authContainer,children:(0,r.jsx)(a.Zp,{className:l().authCard,padding:"lg",children:"login"===i?(0,r.jsxs)("div",{className:l().authForm,children:[(0,r.jsxs)("div",{className:l().authHeader,children:[(0,r.jsx)("h1",{className:l().authTitle,children:n("Добро пожаловать в FluentGo")}),(0,r.jsx)("p",{className:l().authDescription,children:n("Войдите в аккаунт или зарегистрируйтесь, чтобы продолжить")})]}),(0,r.jsxs)("form",{onSubmit:p,className:l().form,children:[(0,r.jsx)("div",{className:l().inputGroup,children:(0,r.jsx)("input",{type:"email",className:l().input,placeholder:n("Введите email"),required:!0})}),(0,r.jsx)("div",{className:l().inputGroup,children:(0,r.jsx)("input",{type:"password",className:l().input,placeholder:n("Введите пароль"),required:!0})}),d&&(0,r.jsx)("div",{className:l().errorMessage,children:n("Неверный email или пароль")}),(0,r.jsx)(a.$n,{type:"submit",variant:"primary",className:l().submitButton,children:n("Войти")})]}),(0,r.jsx)("div",{className:l().forgotPassword,children:(0,r.jsx)("button",{type:"button",className:l().forgotLink,onClick:()=>alert(n("Функция восстановления пароля (в разработке)")),children:n("Забыли пароль?")})}),(0,r.jsx)("div",{className:l().divider,children:(0,r.jsx)("span",{children:n("или")})}),(0,r.jsx)(a.$n,{variant:"secondary",className:l().switchButton,onClick:()=>u("register"),children:n("Зарегистрироваться")}),(0,r.jsxs)("div",{className:l().socialButtons,children:[(0,r.jsxs)("button",{className:l().socialButton,onClick:()=>_("Google"),type:"button",children:[(0,r.jsxs)("svg",{className:l().socialIcon,viewBox:"0 0 24 24",children:[(0,r.jsx)("path",{fill:"#4285F4",d:"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"}),(0,r.jsx)("path",{fill:"#34A853",d:"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"}),(0,r.jsx)("path",{fill:"#FBBC05",d:"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"}),(0,r.jsx)("path",{fill:"#EA4335",d:"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"})]}),(0,r.jsx)("span",{children:n("Войти через Google")})]}),(0,r.jsxs)("button",{className:l().socialButton,onClick:()=>_("Facebook"),type:"button",children:[(0,r.jsx)("svg",{className:l().socialIcon,fill:"#1877F2",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{d:"M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"})}),(0,r.jsx)("span",{children:n("Войти через Facebook")})]})]})]}):(0,r.jsxs)("div",{className:l().authForm,children:[(0,r.jsxs)("div",{className:l().authHeader,children:[(0,r.jsx)("h1",{className:l().authTitle,children:n("Создать аккаунт")}),(0,r.jsx)("p",{className:l().authDescription,children:n("Заполните форму для регистрации")})]}),(0,r.jsxs)("form",{onSubmit:p,className:l().form,children:[(0,r.jsx)("div",{className:l().inputGroup,children:(0,r.jsx)("input",{type:"text",className:l().input,placeholder:n("Введите имя"),required:!0})}),(0,r.jsx)("div",{className:l().inputGroup,children:(0,r.jsx)("input",{type:"email",className:l().input,placeholder:n("Введите email"),required:!0})}),(0,r.jsx)("div",{className:l().inputGroup,children:(0,r.jsx)("input",{type:"password",className:l().input,placeholder:n("Введите пароль"),required:!0})}),(0,r.jsx)("div",{className:l().inputGroup,children:(0,r.jsx)("input",{type:"password",className:l().input,placeholder:n("Подтвердите пароль"),required:!0})}),m&&(0,r.jsx)("div",{className:l().successMessage,children:n("Аккаунт создан! Теперь вы можете войти")}),(0,r.jsx)(a.$n,{type:"submit",variant:"primary",className:l().submitButton,children:n("Создать аккаунт")})]}),(0,r.jsx)("div",{className:l().divider,children:(0,r.jsx)("span",{children:n("или")})}),(0,r.jsx)(a.$n,{variant:"secondary",className:l().switchButton,onClick:()=>u("login"),children:n("Уже есть аккаунт? Войти")})]})})})})})})}},3203:e=>{e.exports={controls:"RealTimeChatUI_controls___xVXa",micSection:"RealTimeChatUI_micSection__3lV_b",statusSection:"RealTimeChatUI_statusSection__uBjsR",statusText:"RealTimeChatUI_statusText__uJvYt",timer:"RealTimeChatUI_timer__ZbLPu",actionButtons:"RealTimeChatUI_actionButtons__dFgtV"}},3339:(e,t,n)=>{"use strict";let r;n.d(t,{CombinedChatComponent:()=>ep});var s=n(5155),a=n(9780),o=n.n(a),i=n(7118),l=n(2821),c=n(8984),u=n(63),d=n(2267),h=n(9244),m=n.n(h),g=n(3782);let p=()=>{let{t:e}=(0,c.Bd)(),t=(0,u.useSearchParams)().get("mode"),n=(0,u.useRouter)();return(0,g.pD)(),(0,s.jsxs)("div",{className:m().modeSelector,children:[(0,s.jsx)("button",{className:(0,l.A)(m().modeTab,{[m().active]:"realtime"===t}),onClick:()=>n.push(d.J.chatPage.chatPageRealtime),type:"button",children:e("В реальном времени")}),(0,s.jsx)("button",{className:(0,l.A)(m().modeTab,{[m().active]:"voice"===t}),onClick:()=>n.push(d.J.chatPage.chatPageVoice),type:"button",children:e("Голосовые сообщения")})]})};var _=n(9815),C=n(2115);let f=e=>{let{url:t,binaryType:n,disabled:r,...s}=e,[a,o]=(0,C.useState)(!1),i=(0,C.useRef)(null),l=function(e){let t=(0,C.useRef)(e);return(0,C.useLayoutEffect)(()=>{t.current=e},[e]),t}(s),c=(0,C.useCallback)(e=>{i.current&&i.current.readyState===WebSocket.OPEN&&i.current.send(e)},[]),u=(0,C.useCallback)(()=>{!r&&(i.current=new WebSocket(t),i.current&&(n&&(i.current.binaryType=n),i.current.onopen=()=>{var e,t;null==(e=(t=l.current).onOpen)||e.call(t),o(!0)},i.current.onmessage=e=>{var t,n;null==(t=(n=l.current).onMessage)||t.call(n,e)},i.current.onclose=()=>{var e,t;null==(e=(t=l.current).onClose)||e.call(t),o(!1)},i.current.onerror=e=>{var t,n;null==(t=(n=l.current).onError)||t.call(n,e),o(!1)}))},[t,n,r]);return(0,C.useEffect)(()=>(u(),()=>{var e;null==(e=i.current)||e.close(),i.current=null}),[u]),{closeConnect:()=>{if(i.current){if(i.current.readyState===WebSocket.OPEN||i.current.readyState===WebSocket.CONNECTING){var e,t;i.current.close(),null==(e=(t=l.current).onClose)||e.call(t)}o(!1)}},send:c,createConnection:u,isActiveConnection:a,wsRef:i}};var b=n(1685),v=n(3203),x=n.n(v),y=n(4627),j=n.n(y);let U=e=>{let{isRecording:t=!1,onClick:n,className:r}=e;return(0,s.jsx)("button",{className:(0,l.A)(j().micButton,{[j().active]:t},r),onClick:n,type:"button",children:"\uD83C\uDFA4"})};var w=n(5548),S=n.n(w),N=n(1479);let A=e=>{let{onClick:t,className:n}=e,{t:r}=(0,c.Bd)();return(0,s.jsx)(N.Y,{variant:"danger",as:"button",onClick:t,className:(0,l.A)(S().endButton,n),children:r("Завершить")})};var P=n(12),M=n.n(P),R=n(708),E=n.n(R);let T=e=>{let{initialChatMessage:t,infoMessage:n,messagesNode:r}=e;return(0,s.jsxs)("div",{className:E().chat_wrapper,children:[t&&(0,s.jsx)("span",{className:E().initial_message,children:t}),(0,s.jsx)("div",{className:E().chat_window,children:r}),n&&!t&&(0,s.jsx)("p",{className:E().info_message,children:n})]})},k=e=>{let{topSlot:t,footerSlot:n,infoMessage:r,initialChatMessage:a,messagesNode:o,className:i}=e;return(0,s.jsxs)("div",{className:(0,l.A)(M().chatContainer,i),children:[t,(0,s.jsx)(T,{messagesNode:o,infoMessage:r,initialChatMessage:a}),!!n&&(0,s.jsx)("div",{className:M().footer_slot,children:n})]})},B=(0,n(7909).default)(()=>Promise.all([n.e(873),n.e(568),n.e(100),n.e(721)]).then(n.bind(n,4721)).then(e=>e.ShowSlotComponent),{loadableGenerated:{webpack:()=>[4721]},ssr:!1});var I=n(5818),D=n(6487),V=n(1628),L=n.n(V);let W=()=>(0,s.jsx)("div",{className:L().modal,children:"Авторизуйтесь, чтобы менять настройки"}),F=e=>{let t=(0,D.r8)();return(0,s.jsx)(B,{position:"center",mode:t?"click":"hover",slot:t?(0,s.jsx)(I.K,{}):(0,s.jsx)(W,{}),children:(0,s.jsx)(i.CS,{blure:!t,...e})})},O=e=>{let{isRecording:t,timer:n,data:r,initChatMessage:a,infoMessage:o,endButtonClick:i,handleMicClick:l,children:u}=e,{t:d}=(0,c.Bd)(),h=null==r?void 0:r.map((e,t)=>null==u?void 0:u(e,t));return(0,s.jsx)(k,{messagesNode:h,infoMessage:o,initialChatMessage:(null==r?void 0:r.length)?"":a,topSlot:(0,s.jsxs)("div",{className:x().controls,children:[(0,s.jsxs)("div",{className:x().micSection,children:[(0,s.jsx)(U,{isRecording:t,onClick:l}),(0,s.jsxs)("div",{className:x().statusSection,children:[(0,s.jsx)("div",{className:x().statusText,children:d(t?"Слушаю... Говорите сейчас":"Начинайте говорить — ассистент слушает")}),(0,s.jsx)("div",{className:x().timer,children:(e=>{let t=Math.floor(e/60);return"".concat(t.toString().padStart(2,"0"),":").concat((e%60).toString().padStart(2,"0"))})(n)})]})]}),(0,s.jsxs)("div",{className:x().actionButtons,children:[(0,s.jsx)(A,{onClick:i}),(0,s.jsx)(F,{})]})]})})};var G=n(5959),H=n(8270);let J=(0,G.v)()((0,H.D)(e=>({messages:[],chatStatus:"",isActiveSession:!0,addMessage:t=>{e(e=>{e.messages.push(t)})},setIsActiveSession:t=>{e(e=>{e.isActiveSession=t})},setChatStatus:t=>{e(e=>{e.chatStatus=t})},clearMessagesStore:()=>{e(e=>{e.messages=[],e.chatStatus=""})}}))),z=()=>J(e=>e.isActiveSession),q={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)},Y=new Uint8Array(16),$=[];for(let e=0;e<256;++e)$.push((e+256).toString(16).slice(1));let K=function(e,t,n){if(q.randomUUID&&!t&&!e)return q.randomUUID();var s=e,a=n;let o=(s=s||{}).random??s.rng?.()??function(){if(!r){if("undefined"==typeof crypto||!crypto.getRandomValues)throw Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");r=crypto.getRandomValues.bind(crypto)}return r(Y)}();if(o.length<16)throw Error("Random bytes length must be >= 16");if(o[6]=15&o[6]|64,o[8]=63&o[8]|128,t){if((a=a||0)<0||a+16>t.length)throw RangeError(`UUID byte range ${a}:${a+15} is out of buffer bounds`);for(let e=0;e<16;++e)t[a+e]=o[e];return t}return function(e,t=0){return($[e[t+0]]+$[e[t+1]]+$[e[t+2]]+$[e[t+3]]+"-"+$[e[t+4]]+$[e[t+5]]+"-"+$[e[t+6]]+$[e[t+7]]+"-"+$[e[t+8]]+$[e[t+9]]+"-"+$[e[t+10]]+$[e[t+11]]+$[e[t+12]]+$[e[t+13]]+$[e[t+14]]+$[e[t+15]]).toLowerCase()}(o)};function Z(){let e=(0,C.useRef)([]),[t,n]=(0,C.useState)(!1),[r,s]=(0,C.useState)(0),a=(0,C.useCallback)(t=>{let r=new DataView(t),a=String.fromCharCode(r.getUint8(0),r.getUint8(1),r.getUint8(2),r.getUint8(3)),o=String.fromCharCode(r.getUint8(8),r.getUint8(9),r.getUint8(10),r.getUint8(11));if("RIFF"!==a||"WAVE"!==o)return void console.warn("Получен не WAV файл или поврежденный заголовок");e.current.push(t),n(!0),s(e.current.length)},[]),o=(0,C.useCallback)(()=>{if(0===e.current.length)return null;try{let t=function(e){if(0===e.length)throw Error("Нет данных для объединения");if(1===e.length)return e[0];let t=function(e){let t=new DataView(e),n=12;for(;n<e.byteLength-8;){let e=String.fromCharCode(t.getUint8(n),t.getUint8(n+1),t.getUint8(n+2),t.getUint8(n+3)),r=t.getUint32(n+4,!0);if("fmt "===e)return{audioFormat:t.getUint16(n+8,!0),channels:t.getUint16(n+10,!0),sampleRate:t.getUint32(n+12,!0),byteRate:t.getUint32(n+16,!0),blockAlign:t.getUint16(n+20,!0),bitsPerSample:t.getUint16(n+22,!0)};n+=8+r}return null}(e[0]);if(!t)throw Error("Не удалось прочитать параметры WAV файла");let n=[],r=0;for(let t of e){let e=function(e){let t=new DataView(e),n=12;for(;n<e.byteLength-8;){let r=String.fromCharCode(t.getUint8(n),t.getUint8(n+1),t.getUint8(n+2),t.getUint8(n+3)),s=t.getUint32(n+4,!0);if("data"===r)return console.log("Извлечено ".concat(s," байт аудио данных")),new Uint8Array(e,n+8,s);if((n+=8+s)>=e.byteLength)break}throw console.error("Структура WAV файла:"),console.error("Первые 50 байт:",new Uint8Array(e.slice(0,50))),Error("Data chunk не найден в WAV файле")}(t);n.push(e),r+=e.length}let s=function(e,t,n,r){let s=new ArrayBuffer(44),a=new DataView(s);return a.setUint8(0,82),a.setUint8(1,73),a.setUint8(2,70),a.setUint8(3,70),a.setUint32(4,36+e,!0),a.setUint8(8,87),a.setUint8(9,65),a.setUint8(10,86),a.setUint8(11,69),a.setUint8(12,102),a.setUint8(13,109),a.setUint8(14,116),a.setUint8(15,32),a.setUint32(16,16,!0),a.setUint16(20,1,!0),a.setUint16(22,n,!0),a.setUint32(24,t,!0),a.setUint32(28,t*n*r/8,!0),a.setUint16(32,n*r/8,!0),a.setUint16(34,r,!0),a.setUint8(36,100),a.setUint8(37,97),a.setUint8(38,116),a.setUint8(39,97),a.setUint32(40,e,!0),new Uint8Array(s)}(r,t.sampleRate,t.channels,t.bitsPerSample),a=new Uint8Array(s.length+r);a.set(s,0);let o=s.length;for(let e of n)a.set(e,o),o+=e.length;return a.buffer}(e.current),r=new Blob([t],{type:"audio/wav"}),a=URL.createObjectURL(r),o=new DataView(t);return String.fromCharCode(o.getUint8(0),o.getUint8(1),o.getUint8(2),o.getUint8(3)),String.fromCharCode(o.getUint8(8),o.getUint8(9),o.getUint8(10),o.getUint8(11)),e.current=[],n(!1),s(0),a}catch(e){return console.error("Ошибка при объединении WAV файлов:",e),null}},[]);return{addChunk:a,finalize:o,reset:(0,C.useCallback)(()=>{e.current=[],n(!1),s(0),console.log("Буфер аудио очищен")},[]),hasChunks:t,chunksCount:r}}let Q=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1e3,[t,n]=(0,C.useState)("no audio"),r=(0,C.useRef)(null),s=(0,C.useRef)(!0);return{onAudioChunk:(0,C.useCallback)(()=>{s.current&&(n("start sending audio"),s.current=!1),r.current&&clearTimeout(r.current),r.current=setTimeout(()=>{n("end sending audio"),s.current=!0},e)},[e]),audioStatus:t}},X={VOICE_DETECTED:"Voice detected. Clearing playback queue.",USER_TIMES_REMAINING:"<b>Минут осталось:</b>"},ee=(0,G.v)((e,t)=>({lastPlayedAudioId:null,setLastPlayedAudioId:t=>{e({lastPlayedAudioId:t})},clearLastPlayedAudioId:()=>{e({lastPlayedAudioId:null})},isAudioAlreadyPlayed:e=>{let{lastPlayedAudioId:n}=t();return n===e}})),et=(0,G.v)()((0,H.D)(e=>({isRecording:!1,timer:0,setIsRecording:t=>{e(e=>{e.isRecording=t})},setTimer:t=>{e(e=>{e.timer=t})},incrementTimer:()=>{e(e=>{e.timer+=1})},toggleMic:()=>{e(e=>{e.isRecording=!e.isRecording})},stopRecording:()=>{e(e=>{e.isRecording=!1})},startRecording:()=>{e(e=>{e.isRecording=!0})},resetTimer:()=>{e(e=>{e.timer=0})},recordVoiceMessage:()=>{e(e=>{e.isRecording||(e.isRecording=!0)})},timerReset:()=>{e(e=>{e.timer=0})}}))),en=e=>{try{if(!e.includes(X.USER_TIMES_REMAINING))return{isRemainingTime:!1,times:null};let t=e.replace(X.USER_TIMES_REMAINING,"").trim(),n=parseInt(t,10);if(isNaN(n))return console.warn("Не удалось преобразовать в число:",t),{isRemainingTime:!0,times:null};return{isRemainingTime:!0,times:n}}catch(e){return console.error("Ошибка парсинга времени из WebSocket сообщения:",e),{isRemainingTime:!1,times:null}}};var er=n(9504),es=n(6105);let ea=()=>{let e=(0,g.Jc)(),t=(0,g.EL)(),[n,r]=(0,C.useState)(""),a=(0,g.wn)(),o=(0,g.Kk)(),i=(0,er.zc)(),l=J(e=>e.setIsActiveSession),c=z(),{currentTopicTitle:u}=(0,es.L)(),{isRecording:d,timer:h,toggleMic:m,stopRecording:p,startRecording:_,resetTimer:v}=(()=>{let e=et(e=>e.isRecording),t=et(e=>e.timer),n=et(e=>e.toggleMic),r=et(e=>e.stopRecording),s=et(e=>e.startRecording),a=et(e=>e.incrementTimer),o=et(e=>e.resetTimer),i=(0,C.useRef)(null);return(0,C.useEffect)(()=>(e?i.current=setInterval(()=>{a()},1e3):i.current&&(clearInterval(i.current),i.current=null),()=>{i.current&&(clearInterval(i.current),i.current=null)}),[e,a]),{isRecording:e,timer:t,toggleMic:n,stopRecording:r,startRecording:s,resetTimer:o}})(),{messages:x,chatStatus:y,clearMessagesStore:j,addMessage:U}=(()=>{let e=J(e=>e.messages),t=J(e=>e.chatStatus),n=z(),r=J(e=>e.addMessage),s=J(e=>e.clearMessagesStore),{addChunk:a,finalize:o,hasChunks:i}=Z(),{audioStatus:l,onAudioChunk:c}=Q(2e3);(0,C.useEffect)(()=>{if("end sending audio"===l&&i){let e=o();e&&r({id:K(),audioData:new ArrayBuffer(0),objectUrl:e,role:"assistant",type:"audio"})}},[l,i,o,r]);let u=(0,C.useCallback)(e=>{try{let t=JSON.parse(e).message;if(!t)return;let n=t.match(/<b>Запрос пользователя:<\/b>\s*(.+)/),s=t.match(/<b>Ответ ассистента:<\/b>\s*(.+)/);if(n||s){let e={id:K(),content:((null==n?void 0:n[1])||(null==s?void 0:s[1])||"").trim(),role:n?"user":"assistant",type:"text"};r(e)}}catch(s){let t=e.match(/<b>Запрос пользователя:<\/b>\s*(.+)/),n=e.match(/<b>Ответ ассистента:<\/b>\s*(.+)/);(t||n)&&r({id:K(),content:((null==t?void 0:t[1])||(null==n?void 0:n[1])||"").trim(),role:t?"user":"assistant",type:"text"})}},[r]);return{messages:e,chatStatus:t,clearMessagesStore:s,addMessage:(0,C.useCallback)(e=>{n&&("string"==typeof e&&u(e),e instanceof ArrayBuffer&&(c(),a(e)))},[a,u,c,n])}})(),{clearPlayedAudioIds:w,registerAudioRef:S,stopPlaingAudioMessageIfUserVoiceDiscovered:N,pauseAllAudio:A}=(e=>{let{messages:t}=e,[n,r]=(0,C.useState)(null),{isAudioAlreadyPlayed:s,setLastPlayedAudioId:a,clearLastPlayedAudioId:o}=ee(),i=(0,C.useRef)(new Map),l=(0,C.useCallback)((e,t)=>{i.current.set(e,t)},[]),c=(0,C.useCallback)(()=>{i.current.forEach(e=>{e.paused||e.pause()})},[]),u=(0,C.useCallback)(()=>{if(null==n?void 0:n.isPLaing){let e=i.current.get(n.id);e&&!e.paused&&(e.pause(),r(null))}},[n]),d=(0,C.useCallback)(e=>{if("string"==typeof e)try{JSON.parse(e).message===X.VOICE_DETECTED&&u()}catch(t){e===X.VOICE_DETECTED&&u()}},[u]);return(0,C.useEffect)(()=>{if(t.length>0){let e=t.findLast(e=>"assistant"===e.role&&"audio"===e.type);if(e&&"audio"===e.type){if((null==n?void 0:n.id)===e.id&&(null==n?void 0:n.isPLaing)||s(e.id))return;c(),setTimeout(()=>{let t=i.current.get(e.id);t&&(r({id:e.id,isPLaing:!0}),t.onended=()=>{r(null)},t.onpause=()=>{r(e=>e?{...e,isPLaing:!1}:null)},t.onplay=()=>{r(e=>e?{...e,isPLaing:!0}:null)},t.play(),a(e.id))},100)}}},[t,n,c,s,a]),{currentPlayingAudio:n,clearPlayedAudioIds:()=>{o()},registerAudioRef:l,pauseCurrentAudio:u,stopPlaingAudioMessageIfUserVoiceDiscovered:d,pauseAllAudio:c}})({messages:x}),{isActiveConnection:P,send:M,createConnection:R,closeConnect:E}=f({binaryType:"arraybuffer",url:b.J.realTimeChatWSConnect({voice:null==t?void 0:t.title,topic:null!=u?u:""}),onMessage:e=>{if("string"==typeof e.data){let{isRemainingTime:t,times:n}=en(e.data);t&&n&&i(n)}N(e.data),U(e.data)},onOpen:()=>{a(),r("Соединение открыто"),console.log("onOpen")},onClose:()=>{o(),r("Соединение закрыто"),console.log("onClose")},onError:()=>{o(),console.log("Ошибка соединения")}}),{startRecordAudio:T,endRecordAudio:k}=(e=>{let{onResult:t,onError:n,onStream:r}=e,[s,a]=(0,C.useState)(!1),o=(0,C.useRef)(!1),i=(0,C.useRef)(null),l=(0,C.useRef)(null),c=(0,C.useRef)(null),u=(0,C.useRef)(null),d=(0,C.useRef)([]),h=(0,C.useCallback)(e=>{let t=e.length,n=new Int16Array(t);for(let r=0;r<t;r++)n[r]=32767*Math.min(1,e[r]);return n.buffer},[]),m=(0,C.useCallback)(e=>{let t=0;for(let n of e)t+=n.byteLength;let n=new ArrayBuffer(44+t),r=new DataView(n),s=(e,t)=>{for(let n=0;n<t.length;n++)r.setUint8(e+n,t.charCodeAt(n))};s(0,"RIFF"),r.setUint32(4,36+t,!0),s(8,"WAVE"),s(12,"fmt "),r.setUint32(16,16,!0),r.setUint16(20,1,!0),r.setUint16(22,1,!0),r.setUint32(24,16e3,!0),r.setUint32(28,32e3,!0),r.setUint16(32,2,!0),r.setUint16(34,16,!0),s(36,"data"),r.setUint32(40,t,!0);let a=44,o=new Uint8Array(n);for(let t of e){let e=new Uint8Array(t);o.set(e,a),a+=t.byteLength}return new Blob([n],{type:"audio/wav"})},[]),g=(0,C.useCallback)(async()=>{if(!s)try{let e=await navigator.mediaDevices.getUserMedia({audio:{sampleRate:16e3,channelCount:1}});u.current=e;let t=new(window.AudioContext||window.webkitAudioContext);i.current=t;let n=t.createMediaStreamSource(e);c.current=n;let s=t.createScriptProcessor(16384,1,1);l.current=s,d.current=[],s.onaudioprocess=e=>{if(o.current){let t=e.inputBuffer.getChannelData(0),n=h(t);if(d.current.push(n),r){let e=new Blob([n],{type:"audio/pcm"});r({arrayBuffer:n,blob:e})}}},n.connect(s),s.connect(t.destination),a(!0),o.current=!0}catch(t){let e=t instanceof Error?t.message:"Неизвестная ошибка";console.error("❌ Ошибка запуска записи:",e),null==n||n("Ошибка доступа к микрофону: ".concat(e))}},[s,r,n,h]);return{isRecordAudio:s,startRecordAudio:g,endRecordAudio:(0,C.useCallback)(()=>{if(a(!1),o.current=!1,l.current&&(l.current.disconnect(),l.current=null),c.current&&(c.current.disconnect(),c.current=null),i.current&&(i.current.close(),i.current=null),u.current&&(u.current.getTracks().forEach(e=>e.stop()),u.current=null),t&&d.current.length>0){let e=m(d.current);t({voiceBlob:e,wavBlob:e})}d.current=[]},[t,m])}})({onStream:e=>{let{arrayBuffer:t}=e;M(t)}});return(0,C.useEffect)(()=>{P||(k(),p())},[P]),(0,C.useEffect)(()=>{v(),p(),k()},[null==t?void 0:t.title,null==e?void 0:e.title]),(0,s.jsx)(O,{data:x,infoMessage:null!=n?n:"",initChatMessage:y||"Запишите голосовое сообщение, чтобы начать",timer:h,isRecording:d,endButtonClick:()=>{k(),v(),p(),A(),l(!1)},handleMicClick:()=>{d?k():T(),P||R(),c||(j(),l(!0)),m()},children:e=>{switch(e.type){case"text":return(0,s.jsx)(g.cM,{role:e.role,children:e.content},e.id);case"audio":return(0,s.jsx)(g.sv,{ref:t=>{t&&S(e.id,t)},controls:!0,src:e.objectUrl},e.id);default:return null}}})};var eo=n(412),ei=n.n(eo);let el=e=>{let{messages:t,isRecording:n,onRecordClick:r,onStopClick:a,initialChatMessage:o,recordingHandlers:l,infoMessage:u,children:d}=e,{t:h}=(0,c.Bd)();return(0,s.jsx)(k,{messagesNode:null==t?void 0:t.map((e,t)=>d(e)),initialChatMessage:o,infoMessage:u,topSlot:(0,s.jsxs)("div",{className:ei().action_buttons,children:[(0,s.jsx)(A,{onClick:a}),(0,s.jsx)(F,{})]}),footerSlot:(0,s.jsx)(i.$n,{variant:n?"secondary":"orange",className:ei().record_button,onClick:r,...l&&{onMouseDown:l.onMouseDown,onMouseUp:l.onMouseUp,onMouseLeave:l.onMouseLeave,onTouchStart:l.onTouchStart,onTouchEnd:l.onTouchEnd,onTouchCancel:l.onTouchCancel},children:h(n?"\uD83D\uDD34 Запись...":"\uD83C\uDFA4 Удерживайте для записи")})})};var ec=n(549),eu=n(4525);let ed=async e=>{let{wavBlob:t,clientId:n}=e,r=new FormData;r.append("file",t,"audio.wav"),r.append("client_id",n);let s=await eu.F.post(b.J.uploadAudioInVoicesChat,{body:r});return await s.json()},eh=(0,G.v)()((0,H.D)(e=>({messages:[],chatStatus:"",addMessage:t=>{e(e=>{e.messages.push(t)})},setChatStatus:t=>{e(e=>{e.chatStatus=t})},clearMessagesStore:()=>{e(e=>{e.messages=[],e.chatStatus=""})}}))),em=()=>{let{t:e}=(0,c.Bd)(),[t,n]=(0,C.useState)(""),[r,a]=(0,C.useState)(""),o=(0,g.wn)(),i=(0,g.Kk)(),l=(0,er.zc)(),u=(0,g.EL)(),{currentTopicTitle:d}=(0,g.LW)(),{messages:h,addVoiceAudioData:m,addVoiceTextMessage:p,clearVoiceMessagesStore:_}=(()=>{let e=eh(e=>e.messages),t=eh(e=>e.chatStatus),n=eh(e=>e.addMessage),r=eh(e=>e.clearMessagesStore),{addChunk:s,finalize:a,hasChunks:o}=Z(),{audioStatus:i,onAudioChunk:l}=Q(2e3);return(0,C.useEffect)(()=>{if("end sending audio"===i&&o){let e=a();e&&n({id:K(),role:"assistant",type:"audio",audioData:"",objectUrl:e})}},[i,o,a,n]),{messages:e,chatStatus:t,clearVoiceMessagesStore:r,addVoiceAudioData:e=>{s(e),l()},addVoiceTextMessage:e=>{let t,r;if("string"!=typeof e.data)return;let s=e.data;if(s.includes("<b>Ответ ассистента:</b>"))t="assistant",r=s.replace("<b>Ответ ассистента:</b>","").trim();else{if(!s.includes("<b>Запрос пользователя:</b>"))return;t="user",r=s.replace("<b>Запрос пользователя:</b>","").trim()}n({id:K(),role:t,type:"text",content:r})},addVoiceMessage:n}})(),{isActiveConnection:v,closeConnect:x,createConnection:y}=f({binaryType:"arraybuffer",url:b.J.voiceMessagesWSConnect({voice:null==u?void 0:u.title,topic:d||""}),onMessage:e=>{if("string"==typeof e.data){let{isRemainingTime:t,times:r}=en(e.data);if(t&&r&&l(r),e.data.startsWith("CONNECTED:")){let t=(e=>{try{let t=JSON.parse(e);if(t.message&&t.message.startsWith("CONNECTED:"))return t.message.replace("CONNECTED:","");return null}catch(t){return console.warn("Ошибка парсинга JSON:",t),console.warn("Пришла просто строка",e),e.replace("CONNECTED:","")}})(e.data);t&&(n(t),console.log(t))}else p(e)}e.data instanceof ArrayBuffer&&m(e.data)},onOpen:()=>{o(),a("Соединение установлено")},onClose:()=>{console.log("Голосовй чат закрыт"),a("Соединение разорвано"),i()},onError:e=>{console.error("Voice message chat error:",e),i()}}),{mutate:j}=(0,ec.n)({mutationFn:ed,onSuccess:e=>{console.log("Audio uploaded successfully:",e)},onError:e=>{console.error("Error uploading audio:",e)}}),{startRecord:U,endRecord:w,isRecording:S}=(e=>{let{onResult:t,onError:n,onStream:r}=e,[s,a]=(0,C.useState)(!1),o=(0,C.useRef)(null),i=(0,C.useRef)(null),l=(0,C.useRef)([]),c=(0,C.useCallback)(e=>{let t=e.sampleRate,n=e.getChannelData(0),r=2*n.length,s=new ArrayBuffer(44+r),a=new DataView(s),o=(e,t)=>{for(let n=0;n<t.length;n++)a.setUint8(e+n,t.charCodeAt(n))};o(0,"RIFF"),a.setUint32(4,36+r,!0),o(8,"WAVE"),o(12,"fmt "),a.setUint32(16,16,!0),a.setUint16(20,1,!0),a.setUint16(22,1,!0),a.setUint32(24,t,!0),a.setUint32(28,2*t,!0),a.setUint16(32,2,!0),a.setUint16(34,16,!0),o(36,"data"),a.setUint32(40,r,!0);let i=44;for(let e=0;e<n.length;e++,i+=2){let t=Math.max(-1,Math.min(1,n[e]));a.setInt16(i,32767*t,!0)}return new Blob([s],{type:"audio/wav"})},[]),u=(0,C.useCallback)(async e=>{try{let t=new(window.AudioContext||window.webkitAudioContext),n=await e.arrayBuffer(),r=await t.decodeAudioData(n);return t.close(),c(r)}catch(t){return console.error("Ошибка конвертации в WAV:",t),new Blob([e],{type:"audio/wav"})}},[c]),d=(0,C.useCallback)(async()=>{try{let e=await navigator.mediaDevices.getUserMedia({audio:!0});i.current=e;let s=new MediaRecorder(e);o.current=s,l.current=[],s.addEventListener("dataavailable",async e=>{if(e.data.size>0&&(l.current.push(e.data),r)){let t=await e.data.arrayBuffer();r({arrayBuffer:t,blob:e.data})}}),s.addEventListener("stop",async()=>{let e=new Blob(l.current,{type:"audio/webm"}),n=await u(e);null==t||t({voiceBlob:e,wavBlob:n}),i.current&&(i.current.getTracks().forEach(e=>e.stop()),i.current=null),o.current=null,l.current=[],a(!1)}),s.addEventListener("error",e=>{let t="Ошибка MediaRecorder: ".concat(e.error);null==n||n(t),a(!1)})}catch(t){let e=t instanceof Error?t.message:"Неизвестная ошибка";null==n||n("Ошибка доступа к микрофону: ".concat(e))}},[t,n,r,u,c]),h=(0,C.useCallback)(async()=>{var e;if(!s&&(null==(e=o.current)?void 0:e.state)!=="recording")try{await d(),o.current&&"inactive"===o.current.state&&(o.current.start(100),a(!0))}catch(t){let e=t instanceof Error?t.message:"Неизвестная ошибка";null==n||n("Ошибка начала записи: ".concat(e))}},[s,d,n]);return{isRecording:s,startRecord:h,endRecord:(0,C.useCallback)(()=>{o.current&&"recording"===o.current.state&&o.current.stop()},[])}})({onResult:e=>{j({wavBlob:e.wavBlob,clientId:t})},onError:e=>{console.error("Ошибка записи:",e)}}),N=()=>{w()},A=()=>{w()};return(0,s.jsx)(el,{infoMessage:r,messages:h,isRecording:S,onRecordClick:()=>{v||y()},onStopClick:()=>{w(),_(),x()},initialChatMessage:h.length?"":e("Удерживайте кнопку для записи голосового сообщения"),recordingHandlers:{onMouseDown:e=>{v||y(),U()},onMouseUp:N,onMouseLeave:N,onTouchStart:e=>{v||y(),U()},onTouchEnd:A,onTouchCancel:A},children:e=>"assistant"===e.role&&"audio"===e.type?(0,s.jsx)(g.sv,{src:e.objectUrl,controls:!0},e.id):"text"===e.type?(0,s.jsx)(g.cM,{role:e.role,children:e.content},e.id):void 0})},eg=()=>{let e=(0,u.useSearchParams)().get("mode");return"realtime"===e?(0,s.jsx)(ea,{}):"voice"===e?(0,s.jsx)(em,{}):null},ep=e=>{let{className:t}=e,{t:n}=(0,c.Bd)(),r=(0,u.useRouter)();return(0,u.useSearchParams)().get("mode"),(0,s.jsx)("section",{className:(0,l.A)(o().section,t),children:(0,s.jsx)(i.mc,{children:(0,s.jsxs)("div",{className:o().demoContainer,children:[(0,s.jsx)("button",{className:o().closeButton,onClick:()=>r.push(d.J.homePage),type:"button",children:"\xd7"}),(0,s.jsxs)(i.xA,{children:[(0,s.jsxs)("div",{className:o().demoContent,children:[(0,s.jsxs)("div",{className:o().demoHeader,children:[(0,s.jsx)("h1",{className:o().demoTitle,children:n("Начни разговор прямо сейчас")}),(0,s.jsx)("p",{className:o().demoDescription,children:n("1 минута демо-беседы бесплатно без регистрации")})]}),(0,s.jsx)(p,{}),(0,s.jsx)(eg,{}),(0,s.jsx)("p",{className:o().helpText,children:n("Выберите режим, что бы начать общение")})]}),(0,s.jsx)("div",{className:o().demoImage,children:(0,s.jsx)(_.y,{})})]})]})})})}},4627:e=>{e.exports={micButton:"MicButton_micButton__Mtt3n",pulse:"MicButton_pulse__HA4P6",active:"MicButton_active__Z25BT","pulse-active":"MicButton_pulse-active___7AyL"}},5075:(e,t,n)=>{"use strict";n.d(t,{MainPage:()=>m});var r=n(5155);n(5637),n(3204),n(5877);var s=n(9877),a=n(2135),o=n(1534),i=n(7097),l=n(933),c=n(6497),u=n(4443);n(7186);var d=n(1509),h=n(4155);let m=()=>(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(l.HeroSection,{}),(0,r.jsx)(c.WhyItWorksSection,{}),(0,r.jsx)(s.HowItWorksSection,{}),(0,r.jsx)(i.VideoPreviewSection,{}),(0,r.jsx)(u.TopicsSection,{}),(0,r.jsx)(a.ReviewsSection,{}),(0,r.jsx)(o.PricingSection,{}),(0,r.jsx)(d.HelpSection,{}),(0,r.jsx)(h.FinalCTA,{})]})},5548:()=>{},7423:e=>{e.exports={page:"AuthPage_page__8HF7Q",authSection:"AuthPage_authSection__L4pr4",authContainer:"AuthPage_authContainer___bodD",authCard:"AuthPage_authCard__AnGmi",authForm:"AuthPage_authForm__4MOyS",authHeader:"AuthPage_authHeader__B4tr0",authTitle:"AuthPage_authTitle__3QOYw",authDescription:"AuthPage_authDescription__ilxV3",form:"AuthPage_form__PQkN4",inputGroup:"AuthPage_inputGroup__trMjf",input:"AuthPage_input__PJzNI",submitButton:"AuthPage_submitButton__cv2tl",switchButton:"AuthPage_switchButton__ljbEC",forgotPassword:"AuthPage_forgotPassword__CAFDY",forgotLink:"AuthPage_forgotLink__vvYlF",divider:"AuthPage_divider__Brqzu",errorMessage:"AuthPage_errorMessage__zy6Tn",successMessage:"AuthPage_successMessage__M8wtI",socialButtons:"AuthPage_socialButtons__XqWfX",socialButton:"AuthPage_socialButton__9WDzr",socialIcon:"AuthPage_socialIcon__8WSrv"}},7723:(e,t,n)=>{Promise.resolve().then(n.t.bind(n,2619,23)),Promise.resolve().then(n.bind(n,4810)),Promise.resolve().then(n.bind(n,3034)),Promise.resolve().then(n.bind(n,8402)),Promise.resolve().then(n.bind(n,3876)),Promise.resolve().then(n.bind(n,7810)),Promise.resolve().then(n.bind(n,3514)),Promise.resolve().then(n.bind(n,6018)),Promise.resolve().then(n.bind(n,2242)),Promise.resolve().then(n.bind(n,6388)),Promise.resolve().then(n.bind(n,3962)),Promise.resolve().then(n.bind(n,7434)),Promise.resolve().then(n.bind(n,3076)),Promise.resolve().then(n.bind(n,5075)),Promise.resolve().then(n.bind(n,5877)),Promise.resolve().then(n.bind(n,3339)),Promise.resolve().then(n.bind(n,4155)),Promise.resolve().then(n.bind(n,3204)),Promise.resolve().then(n.bind(n,5637)),Promise.resolve().then(n.bind(n,1509)),Promise.resolve().then(n.bind(n,933)),Promise.resolve().then(n.bind(n,9877)),Promise.resolve().then(n.bind(n,1534)),Promise.resolve().then(n.bind(n,2135)),Promise.resolve().then(n.bind(n,4443)),Promise.resolve().then(n.bind(n,7097)),Promise.resolve().then(n.bind(n,6497))},9244:e=>{e.exports={modeSelector:"ChangeChatMode_modeSelector__dfvy1",modeTab:"ChangeChatMode_modeTab__KFMNb",active:"ChangeChatMode_active__Wn7tw"}},9780:e=>{e.exports={section:"CombinedChatComponent_section___Gzy4",demoContainer:"CombinedChatComponent_demoContainer__R97_2",closeButton:"CombinedChatComponent_closeButton__ilJXv",demoContent:"CombinedChatComponent_demoContent__vVU8Z",demoHeader:"CombinedChatComponent_demoHeader__uvaMq",demoTitle:"CombinedChatComponent_demoTitle__ngVvD",demoDescription:"CombinedChatComponent_demoDescription__9RdWx",modeSelector:"CombinedChatComponent_modeSelector__5dSRl",modeTab:"CombinedChatComponent_modeTab__mUx2M",active:"CombinedChatComponent_active___Y40F",realtimeInterface:"CombinedChatComponent_realtimeInterface__CZmkg",chatLog:"CombinedChatComponent_chatLog__hESuO",emptyState:"CombinedChatComponent_emptyState__6YPYu",message:"CombinedChatComponent_message__9e5Op",user:"CombinedChatComponent_user__VaKKn",assistant:"CombinedChatComponent_assistant__EgC5j",voiceInterface:"CombinedChatComponent_voiceInterface__goddA",voiceControls:"CombinedChatComponent_voiceControls__mcLZo",recordButton:"CombinedChatComponent_recordButton__2JfMr",helpText:"CombinedChatComponent_helpText__MV0yf",demoImage:"CombinedChatComponent_demoImage__8R8O6",imageCard:"CombinedChatComponent_imageCard__bgbIQ",characterImage:"CombinedChatComponent_characterImage__31g_H"}}}]);