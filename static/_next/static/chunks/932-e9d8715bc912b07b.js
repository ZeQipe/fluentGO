(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[932],{3076:(e,t,n)=>{"use strict";n.d(t,{AuthPage:()=>c});var r=n(95155),s=n(57423),a=n.n(s),o=n(12115),i=n(2821),l=n(13664);let c=e=>{let{className:t}=e,[n,s]=(0,o.useState)("login"),[c,u]=(0,o.useState)(!1),[d,h]=(0,o.useState)(!1),m=e=>{e.preventDefault(),u(!1),h(!1),"login"===n?u(!0):(h(!0),setTimeout(()=>{s("login"),h(!1)},2e3))},g=e=>{alert("".concat(e," authorization (demo)"))};return(0,r.jsx)("div",{className:(0,i.A)(a().page,t),children:(0,r.jsx)("section",{className:a().authSection,children:(0,r.jsx)(l.mc,{children:(0,r.jsx)("div",{className:a().authContainer,children:(0,r.jsx)(l.Zp,{className:a().authCard,padding:"lg",children:"login"===n?(0,r.jsxs)("div",{className:a().authForm,children:[(0,r.jsxs)("div",{className:a().authHeader,children:[(0,r.jsx)("h1",{className:a().authTitle,children:"Welcome to FluentGo"}),(0,r.jsx)("p",{className:a().authDescription,children:"Sign in to your account or register to continue"})]}),(0,r.jsxs)("form",{onSubmit:m,className:a().form,children:[(0,r.jsx)("div",{className:a().inputGroup,children:(0,r.jsx)("input",{type:"email",className:a().input,placeholder:"Enter email",required:!0})}),(0,r.jsx)("div",{className:a().inputGroup,children:(0,r.jsx)("input",{type:"password",className:a().input,placeholder:"Enter password",required:!0})}),c&&(0,r.jsx)("div",{className:a().errorMessage,children:"Invalid email or password"}),(0,r.jsx)(l.$n,{type:"submit",variant:"primary",className:a().submitButton,children:"Sign In"})]}),(0,r.jsx)("div",{className:a().forgotPassword,children:(0,r.jsx)("button",{type:"button",className:a().forgotLink,onClick:()=>alert("Password recovery feature (in development)"),children:"Forgot password?"})}),(0,r.jsx)("div",{className:a().divider,children:(0,r.jsx)("span",{children:"or"})}),(0,r.jsx)(l.$n,{variant:"secondary",className:a().switchButton,onClick:()=>s("register"),children:"Register"}),(0,r.jsxs)("div",{className:a().socialButtons,children:[(0,r.jsxs)("button",{className:a().socialButton,onClick:()=>g("Google"),type:"button",children:[(0,r.jsxs)("svg",{className:a().socialIcon,viewBox:"0 0 24 24",children:[(0,r.jsx)("path",{fill:"#4285F4",d:"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"}),(0,r.jsx)("path",{fill:"#34A853",d:"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"}),(0,r.jsx)("path",{fill:"#FBBC05",d:"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"}),(0,r.jsx)("path",{fill:"#EA4335",d:"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"})]}),(0,r.jsx)("span",{children:"Sign in with Google"})]}),(0,r.jsxs)("button",{className:a().socialButton,onClick:()=>g("Facebook"),type:"button",children:[(0,r.jsx)("svg",{className:a().socialIcon,fill:"#1877F2",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{d:"M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"})}),(0,r.jsx)("span",{children:"Sign in with Facebook"})]})]})]}):(0,r.jsxs)("div",{className:a().authForm,children:[(0,r.jsxs)("div",{className:a().authHeader,children:[(0,r.jsx)("h1",{className:a().authTitle,children:"Create Account"}),(0,r.jsx)("p",{className:a().authDescription,children:"Fill out the form to register"})]}),(0,r.jsxs)("form",{onSubmit:m,className:a().form,children:[(0,r.jsx)("div",{className:a().inputGroup,children:(0,r.jsx)("input",{type:"text",className:a().input,placeholder:"Enter name",required:!0})}),(0,r.jsx)("div",{className:a().inputGroup,children:(0,r.jsx)("input",{type:"email",className:a().input,placeholder:"Enter email",required:!0})}),(0,r.jsx)("div",{className:a().inputGroup,children:(0,r.jsx)("input",{type:"password",className:a().input,placeholder:"Enter password",required:!0})}),(0,r.jsx)("div",{className:a().inputGroup,children:(0,r.jsx)("input",{type:"password",className:a().input,placeholder:"Confirm password",required:!0})}),d&&(0,r.jsx)("div",{className:a().successMessage,children:"Account created! You can now log in"}),(0,r.jsx)(l.$n,{type:"submit",variant:"primary",className:a().submitButton,children:"Create Account"})]}),(0,r.jsx)("div",{className:a().divider,children:(0,r.jsx)("span",{children:"or"})}),(0,r.jsx)(l.$n,{variant:"secondary",className:a().switchButton,onClick:()=>s("login"),children:"Already have an account? Sign In"})]})})})})})})};c.displayName="AuthPage"},4932:(e,t,n)=>{Promise.resolve().then(n.t.bind(n,52619,23)),Promise.resolve().then(n.bind(n,4810)),Promise.resolve().then(n.bind(n,93034)),Promise.resolve().then(n.bind(n,38402)),Promise.resolve().then(n.bind(n,83876)),Promise.resolve().then(n.bind(n,45224)),Promise.resolve().then(n.bind(n,47810)),Promise.resolve().then(n.bind(n,71981)),Promise.resolve().then(n.bind(n,89228)),Promise.resolve().then(n.bind(n,96018)),Promise.resolve().then(n.bind(n,92242)),Promise.resolve().then(n.bind(n,57602)),Promise.resolve().then(n.bind(n,51264)),Promise.resolve().then(n.bind(n,56388)),Promise.resolve().then(n.bind(n,99534)),Promise.resolve().then(n.bind(n,53962)),Promise.resolve().then(n.bind(n,55302)),Promise.resolve().then(n.bind(n,3076)),Promise.resolve().then(n.bind(n,21042)),Promise.resolve().then(n.bind(n,67693)),Promise.resolve().then(n.bind(n,64652)),Promise.resolve().then(n.bind(n,84155)),Promise.resolve().then(n.bind(n,83145)),Promise.resolve().then(n.bind(n,55637)),Promise.resolve().then(n.bind(n,87721)),Promise.resolve().then(n.bind(n,40933)),Promise.resolve().then(n.bind(n,59877)),Promise.resolve().then(n.bind(n,41534)),Promise.resolve().then(n.bind(n,42135)),Promise.resolve().then(n.bind(n,3785)),Promise.resolve().then(n.bind(n,74443)),Promise.resolve().then(n.bind(n,49478)),Promise.resolve().then(n.bind(n,36497))},13203:e=>{e.exports={controls:"RealTimeChatUI_controls___xVXa",micSection:"RealTimeChatUI_micSection__3lV_b",statusSection:"RealTimeChatUI_statusSection__uBjsR",statusText:"RealTimeChatUI_statusText__uJvYt",timer:"RealTimeChatUI_timer__ZbLPu",actionButtons:"RealTimeChatUI_actionButtons__dFgtV"}},20708:e=>{e.exports={chat_wrapper:"ChatWindow_chat_wrapper__5_GGR",chat_window:"ChatWindow_chat_window__2a6p8",initial_message:"ChatWindow_initial_message__ntJUV",info_message:"ChatWindow_info_message__7yyI_"}},21042:(e,t,n)=>{"use strict";n.d(t,{MainPage:()=>a});var r=n(95155),s=n(36679);let a=()=>(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(s.KE,{}),(0,r.jsx)(s.zF,{}),(0,r.jsx)(s.bz,{}),(0,r.jsx)(s.Ti,{}),(0,r.jsx)(s.ik,{}),(0,r.jsx)(s.X3,{}),(0,r.jsx)(s.cF,{}),(0,r.jsx)(s.Bw,{}),(0,r.jsx)(s.P8,{})]});a.displayName="MainPage"},24598:()=>{},30412:e=>{e.exports={action_buttons:"VoiceMessagesChatUI_action_buttons__APf0G",record_button:"VoiceMessagesChatUI_record_button__bUNNd"}},31628:e=>{e.exports={modal:"s_modal__gpWQu"}},40012:e=>{e.exports={chatContainer:"ChatContainer_chatContainer__pCqLx",footer_slot:"ChatContainer_footer_slot__pEzeo"}},44627:e=>{e.exports={micButton:"MicButton_micButton__Mtt3n",pulse:"MicButton_pulse__HA4P6",active:"MicButton_active__Z25BT","pulse-active":"MicButton_pulse-active___7AyL"}},49780:e=>{e.exports={section:"CombinedChatComponent_section___Gzy4",demoContainer:"CombinedChatComponent_demoContainer__R97_2",closeButton:"CombinedChatComponent_closeButton__ilJXv",demoContent:"CombinedChatComponent_demoContent__vVU8Z",demoHeader:"CombinedChatComponent_demoHeader__uvaMq",demoTitle:"CombinedChatComponent_demoTitle__ngVvD",demoDescription:"CombinedChatComponent_demoDescription__9RdWx",modeSelector:"CombinedChatComponent_modeSelector__5dSRl",modeTab:"CombinedChatComponent_modeTab__mUx2M",active:"CombinedChatComponent_active___Y40F",realtimeInterface:"CombinedChatComponent_realtimeInterface__CZmkg",chatLog:"CombinedChatComponent_chatLog__hESuO",emptyState:"CombinedChatComponent_emptyState__6YPYu",message:"CombinedChatComponent_message__9e5Op",user:"CombinedChatComponent_user__VaKKn",assistant:"CombinedChatComponent_assistant__EgC5j",voiceInterface:"CombinedChatComponent_voiceInterface__goddA",voiceControls:"CombinedChatComponent_voiceControls__mcLZo",recordButton:"CombinedChatComponent_recordButton__2JfMr",helpText:"CombinedChatComponent_helpText__MV0yf",demoImage:"CombinedChatComponent_demoImage__8R8O6",imageCard:"CombinedChatComponent_imageCard__bgbIQ",characterImage:"CombinedChatComponent_characterImage__31g_H"}},55548:()=>{},57423:e=>{e.exports={page:"AuthPage_page__8HF7Q",authSection:"AuthPage_authSection__L4pr4",authContainer:"AuthPage_authContainer___bodD",authCard:"AuthPage_authCard__AnGmi",authForm:"AuthPage_authForm__4MOyS",authHeader:"AuthPage_authHeader__B4tr0",authTitle:"AuthPage_authTitle__3QOYw",authDescription:"AuthPage_authDescription__ilxV3",form:"AuthPage_form__PQkN4",inputGroup:"AuthPage_inputGroup__trMjf",input:"AuthPage_input__PJzNI",submitButton:"AuthPage_submitButton__cv2tl",switchButton:"AuthPage_switchButton__ljbEC",forgotPassword:"AuthPage_forgotPassword__CAFDY",forgotLink:"AuthPage_forgotLink__vvYlF",divider:"AuthPage_divider__Brqzu",errorMessage:"AuthPage_errorMessage__zy6Tn",successMessage:"AuthPage_successMessage__M8wtI",socialButtons:"AuthPage_socialButtons__XqWfX",socialButton:"AuthPage_socialButton__9WDzr",socialIcon:"AuthPage_socialIcon__8WSrv"}},64652:(e,t,n)=>{"use strict";let r;n.d(t,{CombinedChatComponentWrapper:()=>eU});var s=n(95155),a=n(12115),o=n(49780),i=n.n(o),l=n(20063),c=n(2821),u=n(13664),d=n(9815),h=n(82267),m=n(79244),g=n.n(m),p=n(63782);let C=()=>{let e=(0,l.useSearchParams)().get("mode"),t=(0,l.useRouter)();return(0,p.pD)(),(0,s.jsxs)("div",{className:g().modeSelector,children:[(0,s.jsx)("button",{className:(0,c.A)(g().modeTab,{[g().active]:"realtime"===e}),onClick:()=>t.push(h.J.chatPage.chatPageRealtime),type:"button",children:"Real Time"}),(0,s.jsx)("button",{className:(0,c.A)(g().modeTab,{[g().active]:"voice"===e}),onClick:()=>t.push(h.J.chatPage.chatPageVoice),type:"button",children:"Voice Messages"})]})};C.displayName="ChangeChatMode";let f=e=>{let{url:t,binaryType:n,disabled:r,...s}=e,[o,i]=(0,a.useState)(!1),l=(0,a.useRef)(null),c=function(e){let t=(0,a.useRef)(e);return(0,a.useLayoutEffect)(()=>{t.current=e},[e]),t}(s),u=(0,a.useCallback)(e=>{l.current&&l.current.readyState===WebSocket.OPEN&&l.current.send(e)},[]),d=(0,a.useCallback)(()=>{console.log("createConnection",r),!r&&(l.current=new WebSocket(t),l.current&&(n&&(l.current.binaryType=n),l.current.onopen=()=>{var e,t;null==(e=(t=c.current).onOpen)||e.call(t),i(!0)},l.current.onmessage=e=>{var t,n;null==(t=(n=c.current).onMessage)||t.call(n,e)},l.current.onclose=()=>{var e,t;null==(e=(t=c.current).onClose)||e.call(t),i(!1)},l.current.onerror=e=>{var t,n;null==(t=(n=c.current).onError)||t.call(n,e),i(!1)}))},[t,n,r]);return(0,a.useEffect)(()=>(d(),()=>{var e;console.log("закрытие соединения"),null==(e=l.current)||e.close(),l.current=null}),[d]),{closeConnect:()=>{if(l.current){if(l.current.readyState===WebSocket.OPEN||l.current.readyState===WebSocket.CONNECTING){var e,t;l.current.close(),null==(e=(t=c.current).onClose)||e.call(t)}i(!1)}},send:u,createConnection:d,isActiveConnection:o,wsRef:l}};var v=n(1685),_=n(13203),b=n.n(_),x=n(44627),y=n.n(x);let w=e=>{let{isRecording:t=!1,onClick:n,className:r}=e;return(0,s.jsx)("button",{className:(0,c.A)(y().micButton,{[y().active]:t},r),onClick:n,type:"button",children:"\uD83C\uDFA4"})};w.displayName="MicButton";var j=n(23261),S=n(31628),U=n.n(S);let N=()=>(0,s.jsx)("div",{className:U().modal,children:"Please log in to change settings"});N.displayName="NotAuthModal";var E=n(55302),A=n(66171);let P=e=>{let t=(0,A.r8)();return(0,s.jsx)(E.ShowSlotComponent,{position:"center",mode:t?"click":"hover",slot:t?(0,s.jsx)(j.K,{}):(0,s.jsx)(N,{}),children:(0,s.jsx)(u.CS,{opacity:!t,...e})})};P.displayName="ChatSettingButton";var R=n(55548),M=n.n(R),T=n(81479);let k=e=>{let{onClick:t,className:n}=e;return(0,s.jsx)(T.Y,{variant:"danger",as:"button",onClick:t,className:(0,c.A)(M().endButton,n),children:"End"})};k.displayName="EndButton";var I=n(40012),B=n.n(I),L=n(20708),D=n.n(L),V=n(61689);let F=e=>{let{initialChatMessage:t,infoMessage:n,messagesNode:r,scrollRef:a,isExpanded:o=!0}=e;return(0,s.jsxs)(V.P.div,{ref:a,className:D().chat_wrapper,initial:{height:"200px"},animate:{height:o?"200px":"0px",opacity:+!!o},transition:{duration:.3,ease:"easeInOut"},style:{overflow:o?"auto":"hidden"},children:[t&&(0,s.jsx)("span",{className:D().initial_message,children:t}),(0,s.jsx)("div",{className:D().chat_window,children:r}),n&&!t&&(0,s.jsx)("p",{className:D().info_message,children:n})]})};F.displayName="ChatWindow";let W=e=>{let{topSlot:t,footerSlot:n,infoMessage:r,initialChatMessage:a,messagesNode:o,scrollRef:i,className:l,isExpanded:u}=e;return(0,s.jsxs)("div",{className:(0,c.A)(B().chatContainer,l),children:[t,(0,s.jsx)(F,{scrollRef:i,messagesNode:o,infoMessage:r,initialChatMessage:a,isExpanded:u}),!!n&&(0,s.jsx)("div",{className:B().footer_slot,children:n})]})};W.displayName="ChatContainer";var H=n(24598),O=n.n(H);let G={collapsed:"Expand",expanded:"Collapse"},z=e=>{let{isExpanded:t,onClick:n,className:r}=e;return t?G.expanded:G.collapsed,G.collapsed.length,G.expanded.length,(0,s.jsx)(T.Y,{variant:"standart",as:"button",onClick:n,className:(0,c.A)(O().expandButton,r),children:t?"Collapse":"Expand"})};z.displayName="ExpandButton";let q=e=>{let{isRecording:t,isExpanded:n,timer:r,data:a,initChatMessage:o,infoMessage:i,scrollRef:l,endButtonClick:c,handleMicClick:u,expandButtonClick:d,children:h}=e,m=null==a?void 0:a.map((e,t)=>null==h?void 0:h(e,t));return(0,s.jsx)(W,{scrollRef:l,messagesNode:m,infoMessage:i,initialChatMessage:(null==a?void 0:a.length)?"":o,isExpanded:n,topSlot:(0,s.jsxs)("div",{className:b().controls,children:[(0,s.jsxs)("div",{className:b().micSection,children:[(0,s.jsx)(w,{isRecording:t,onClick:u}),(0,s.jsxs)("div",{className:b().statusSection,children:[(0,s.jsx)("div",{className:b().statusText,children:t?"Listening... Speak now":"Start speaking — assistant is listening"}),(0,s.jsx)("div",{className:b().timer,children:(e=>{let t=Math.floor(e/60);return"".concat(t.toString().padStart(2,"0"),":").concat((e%60).toString().padStart(2,"0"))})(r)})]})]}),(0,s.jsxs)("div",{className:b().actionButtons,children:[(0,s.jsx)(k,{onClick:c}),(0,s.jsx)(z,{isExpanded:n,onClick:d}),(0,s.jsx)(P,{})]})]})})};q.displayName="RealTimeChatUI";var J=n(25959),Y=n(58270);let K=(0,J.v)()((0,Y.D)(e=>({messages:[],chatStatus:"",isActiveSession:!0,addMessage:t=>{e(e=>{e.messages.push(t)})},setIsActiveSession:t=>{e(e=>{e.isActiveSession=t})},setChatStatus:t=>{e(e=>{e.chatStatus=t})},clearMessagesStore:()=>{e(e=>{e.messages=[],e.chatStatus=""})}}))),$=()=>K(e=>e.isActiveSession),Z={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)},Q=new Uint8Array(16),X=[];for(let e=0;e<256;++e)X.push((e+256).toString(16).slice(1));let ee=function(e,t,n){if(Z.randomUUID&&!t&&!e)return Z.randomUUID();var s=e,a=n;let o=(s=s||{}).random??s.rng?.()??function(){if(!r){if("undefined"==typeof crypto||!crypto.getRandomValues)throw Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");r=crypto.getRandomValues.bind(crypto)}return r(Q)}();if(o.length<16)throw Error("Random bytes length must be >= 16");if(o[6]=15&o[6]|64,o[8]=63&o[8]|128,t){if((a=a||0)<0||a+16>t.length)throw RangeError(`UUID byte range ${a}:${a+15} is out of buffer bounds`);for(let e=0;e<16;++e)t[a+e]=o[e];return t}return function(e,t=0){return(X[e[t+0]]+X[e[t+1]]+X[e[t+2]]+X[e[t+3]]+"-"+X[e[t+4]]+X[e[t+5]]+"-"+X[e[t+6]]+X[e[t+7]]+"-"+X[e[t+8]]+X[e[t+9]]+"-"+X[e[t+10]]+X[e[t+11]]+X[e[t+12]]+X[e[t+13]]+X[e[t+14]]+X[e[t+15]]).toLowerCase()}(o)};function et(){let e=(0,a.useRef)([]),[t,n]=(0,a.useState)(!1),[r,s]=(0,a.useState)(0),o=(0,a.useCallback)(t=>{let r=new DataView(t),a=String.fromCharCode(r.getUint8(0),r.getUint8(1),r.getUint8(2),r.getUint8(3)),o=String.fromCharCode(r.getUint8(8),r.getUint8(9),r.getUint8(10),r.getUint8(11));if("RIFF"!==a||"WAVE"!==o)return void console.warn("Получен не WAV файл или поврежденный заголовок");e.current.push(t),n(!0),s(e.current.length)},[]),i=(0,a.useCallback)(()=>{if(0===e.current.length)return null;try{let t=function(e){if(0===e.length)throw Error("Нет данных для объединения");if(1===e.length)return e[0];let t=function(e){let t=new DataView(e),n=12;for(;n<e.byteLength-8;){let e=String.fromCharCode(t.getUint8(n),t.getUint8(n+1),t.getUint8(n+2),t.getUint8(n+3)),r=t.getUint32(n+4,!0);if("fmt "===e)return{audioFormat:t.getUint16(n+8,!0),channels:t.getUint16(n+10,!0),sampleRate:t.getUint32(n+12,!0),byteRate:t.getUint32(n+16,!0),blockAlign:t.getUint16(n+20,!0),bitsPerSample:t.getUint16(n+22,!0)};n+=8+r}return null}(e[0]);if(!t)throw Error("Не удалось прочитать параметры WAV файла");let n=[],r=0;for(let t of e){let e=function(e){let t=new DataView(e),n=12;for(;n<e.byteLength-8;){let r=String.fromCharCode(t.getUint8(n),t.getUint8(n+1),t.getUint8(n+2),t.getUint8(n+3)),s=t.getUint32(n+4,!0);if("data"===r)return console.log("Извлечено ".concat(s," байт аудио данных")),new Uint8Array(e,n+8,s);if((n+=8+s)>=e.byteLength)break}throw console.error("Структура WAV файла:"),console.error("Первые 50 байт:",new Uint8Array(e.slice(0,50))),Error("Data chunk не найден в WAV файле")}(t);n.push(e),r+=e.length}let s=function(e,t,n,r){let s=new ArrayBuffer(44),a=new DataView(s);return a.setUint8(0,82),a.setUint8(1,73),a.setUint8(2,70),a.setUint8(3,70),a.setUint32(4,36+e,!0),a.setUint8(8,87),a.setUint8(9,65),a.setUint8(10,86),a.setUint8(11,69),a.setUint8(12,102),a.setUint8(13,109),a.setUint8(14,116),a.setUint8(15,32),a.setUint32(16,16,!0),a.setUint16(20,1,!0),a.setUint16(22,n,!0),a.setUint32(24,t,!0),a.setUint32(28,t*n*r/8,!0),a.setUint16(32,n*r/8,!0),a.setUint16(34,r,!0),a.setUint8(36,100),a.setUint8(37,97),a.setUint8(38,116),a.setUint8(39,97),a.setUint32(40,e,!0),new Uint8Array(s)}(r,t.sampleRate,t.channels,t.bitsPerSample),a=new Uint8Array(s.length+r);a.set(s,0);let o=s.length;for(let e of n)a.set(e,o),o+=e.length;return a.buffer}(e.current),r=new Blob([t],{type:"audio/wav"}),a=URL.createObjectURL(r),o=new DataView(t);return String.fromCharCode(o.getUint8(0),o.getUint8(1),o.getUint8(2),o.getUint8(3)),String.fromCharCode(o.getUint8(8),o.getUint8(9),o.getUint8(10),o.getUint8(11)),e.current=[],n(!1),s(0),a}catch(e){return console.error("Ошибка при объединении WAV файлов:",e),null}},[]);return{addChunk:o,finalize:i,reset:(0,a.useCallback)(()=>{e.current=[],n(!1),s(0),console.log("Буфер аудио очищен")},[]),hasChunks:t,chunksCount:r}}let en=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1e3,[t,n]=(0,a.useState)("no audio"),r=(0,a.useRef)(null),s=(0,a.useRef)(!0);return{onAudioChunk:(0,a.useCallback)(()=>{s.current&&(n("start sending audio"),s.current=!1),r.current&&clearTimeout(r.current),r.current=setTimeout(()=>{n("end sending audio"),s.current=!0},e)},[e]),audioStatus:t}};n(75847);let er=(e,t)=>{var n;let r=null!=(n=null==t?void 0:t.threshold)?n:10,s=(0,a.useRef)(null),[o,i]=(0,a.useState)(!0),l=(0,a.useRef)(e.length),c=(0,a.useCallback)(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"smooth",t=s.current;t&&("function"==typeof t.scrollTo?t.scrollTo({top:t.scrollHeight,behavior:e}):t.scrollTop=t.scrollHeight)},[]),u=(0,a.useCallback)(()=>{let e=s.current;e&&i(e.scrollHeight-e.scrollTop-e.clientHeight<=r)},[r]);return(0,a.useEffect)(()=>{let e=s.current;if(e)return e.addEventListener("scroll",u,{passive:!0}),()=>{e.removeEventListener("scroll",u)}},[u]),(0,a.useEffect)(()=>{let e=requestAnimationFrame(()=>{c("auto")});return()=>cancelAnimationFrame(e)},[c]),(0,a.useEffect)(()=>{let t=e.length>l.current;if(l.current=e.length,!t||!o)return;let n=requestAnimationFrame(()=>{c()});return()=>cancelAnimationFrame(n)},[e,o,c]),{containerRef:s,isAtBottom:o,scrollToBottom:c}},es={VOICE_DETECTED:"Voice detected. Clearing playback queue.",USER_TIMES_REMAINING:"<b>Минут осталось:</b>"},ea=(0,J.v)((e,t)=>({lastPlayedAudioId:null,setLastPlayedAudioId:t=>{e({lastPlayedAudioId:t})},clearLastPlayedAudioId:()=>{e({lastPlayedAudioId:null})},isAudioAlreadyPlayed:e=>{let{lastPlayedAudioId:n}=t();return n===e}})),eo=(0,J.v)()((0,Y.D)(e=>({isRecording:!1,timer:0,setIsRecording:t=>{e(e=>{e.isRecording=t})},setTimer:t=>{e(e=>{e.timer=t})},incrementTimer:()=>{e(e=>{e.timer+=1})},toggleMic:()=>{e(e=>{e.isRecording=!e.isRecording})},stopRecording:()=>{e(e=>{e.isRecording=!1})},startRecording:()=>{e(e=>{e.isRecording=!0})},resetTimer:()=>{e(e=>{e.timer=0})},recordVoiceMessage:()=>{e(e=>{e.isRecording||(e.isRecording=!0)})},timerReset:()=>{e(e=>{e.timer=0})}}))),ei=e=>{try{if(!e.includes(es.USER_TIMES_REMAINING))return{isRemainingTime:!1,times:null};let t=e.replace(es.USER_TIMES_REMAINING,"").trim(),n=parseInt(t,10);if(isNaN(n))return{isRemainingTime:!0,times:null};return{isRemainingTime:!0,times:n}}catch(e){return console.error("Ошибка парсинга времени из WebSocket сообщения:",e),{isRemainingTime:!1,times:null}}};var el=n(69504),ec=n(96105),eu=n(22454),ed=n(94525);let eh={getSessionId:"getSessionId"};var em=n(22663);let eg=e=>{var t;403===(null==e||null==(t=e.response)?void 0:t.status)&&((0,em.Ay)("Your minutes have run out. Please renew your subscription ⛔",{duration:6e3,position:"top-center"}),setTimeout(()=>{let e=document.querySelector("#pricing");e&&e.scrollIntoView({behavior:"smooth"})},1e3))};var ep=n(84564);let eC=()=>{let e=(0,a.useRef)(!1),t=(0,eu.I)({queryKey:[eh.getSessionId],queryFn:async()=>(e.current=!1,await ed.F.get(v.J.getSessionId).json()),select:e=>e.session_id,retry:!1,enabled:!1});return(0,a.useEffect)(()=>{t.isError&&t.error&&(t.error instanceof ep.H&&403===t.error.response.status&&(e.current=!0),eg(t.error))},[t.isError,t.error]),{...t,has403ErrorHandled:e}},ef=()=>{let e=(0,p.Jc)(),t=(0,p.EL)(),n=(0,p.GT)(),[r,o]=(0,a.useState)(""),[i,l]=(0,a.useState)(!0),[c,u]=(0,a.useState)(null),[d,h]=(0,a.useState)(!1),m=(0,p.wn)(),g=(0,p.Kk)(),C=(0,el.zc)(),_=K(e=>e.setIsActiveSession),b=$(),{currentTopicTitle:x}=(0,ec.L)(),{isRecording:y,timer:w,toggleMic:j,stopRecording:S,startRecording:U,resetTimer:N}=(()=>{let e=eo(e=>e.isRecording),t=eo(e=>e.timer),n=eo(e=>e.toggleMic),r=eo(e=>e.stopRecording),s=eo(e=>e.startRecording),o=eo(e=>e.incrementTimer),i=eo(e=>e.resetTimer),l=(0,a.useRef)(null);return(0,a.useEffect)(()=>(e?l.current=setInterval(()=>{o()},1e3):l.current&&(clearInterval(l.current),l.current=null),()=>{l.current&&(clearInterval(l.current),l.current=null)}),[e,o]),{isRecording:e,timer:t,toggleMic:n,stopRecording:r,startRecording:s,resetTimer:i}})(),{messages:E,chatStatus:A,clearMessagesStore:P,addMessage:R}=(()=>{let e=K(e=>e.messages),t=K(e=>e.chatStatus),n=$(),r=K(e=>e.addMessage),s=K(e=>e.clearMessagesStore),{addChunk:o,finalize:i,hasChunks:l}=et(),{audioStatus:c,onAudioChunk:u}=en(2e3);(0,a.useEffect)(()=>{if("end sending audio"===c&&l){let e=i();e&&r({id:ee(),audioData:new ArrayBuffer(0),objectUrl:e,role:"assistant",type:"audio"})}},[c,l,i,r]);let d=(0,a.useCallback)(e=>{try{let t=JSON.parse(e).message;if(!t)return;let n=t.match(/<b>Запрос пользователя:<\/b>\s*(.+)/),s=t.match(/<b>Ответ ассистента:<\/b>\s*(.+)/);if(n||s){let e={id:ee(),content:((null==n?void 0:n[1])||(null==s?void 0:s[1])||"").trim(),role:n?"user":"assistant",type:"text"};r(e)}}catch(s){let t=e.match(/<b>Запрос пользователя:<\/b>\s*(.+)/),n=e.match(/<b>Ответ ассистента:<\/b>\s*(.+)/);(t||n)&&r({id:ee(),content:((null==t?void 0:t[1])||(null==n?void 0:n[1])||"").trim(),role:t?"user":"assistant",type:"text"})}},[r]);return{messages:e,chatStatus:t,clearMessagesStore:s,addMessage:(0,a.useCallback)(e=>{n&&("string"==typeof e&&d(e),e instanceof ArrayBuffer&&(u(),o(e)))},[o,d,u,n])}})(),{containerRef:M}=er(E,{threshold:100}),{clearPlayedAudioIds:T,registerAudioRef:k,stopPlaingAudioMessageIfUserVoiceDiscovered:I,pauseAllAudio:B}=(e=>{let{messages:t}=e,[n,r]=(0,a.useState)(null),{isAudioAlreadyPlayed:s,setLastPlayedAudioId:o,clearLastPlayedAudioId:i}=ea(),l=(0,a.useRef)(new Map),c=(0,a.useCallback)((e,t)=>{l.current.set(e,t)},[]),u=(0,a.useCallback)(()=>{l.current.forEach(e=>{e.paused||e.pause()})},[]),d=(0,a.useCallback)(()=>{if(null==n?void 0:n.isPLaing){let e=l.current.get(n.id);e&&!e.paused&&(e.pause(),r(null))}},[n]),h=(0,a.useCallback)(e=>{if("string"==typeof e)try{JSON.parse(e).message===es.VOICE_DETECTED&&d()}catch(t){e===es.VOICE_DETECTED&&d()}},[d]);return(0,a.useEffect)(()=>{if(t.length>0){let e=t.findLast(e=>"assistant"===e.role&&"audio"===e.type);if(e&&"audio"===e.type){if((null==n?void 0:n.id)===e.id&&(null==n?void 0:n.isPLaing)||s(e.id))return;u(),setTimeout(()=>{let t=l.current.get(e.id);t&&(r({id:e.id,isPLaing:!0}),t.onended=()=>{r(null)},t.onpause=()=>{r(e=>e?{...e,isPLaing:!1}:null)},t.onplay=()=>{r(e=>e?{...e,isPLaing:!0}:null)},t.play(),o(e.id))},100)}}},[t,n,u,s,o]),{currentPlayingAudio:n,clearPlayedAudioIds:()=>{i()},registerAudioRef:c,pauseCurrentAudio:d,stopPlaingAudioMessageIfUserVoiceDiscovered:h,pauseAllAudio:u}})({messages:E}),{refetch:L,has403ErrorHandled:D}=eC(),V=(0,a.useMemo)(()=>v.J.realTimeChatWSConnect({voice:null==t?void 0:t.title,topic:null!=x?x:"",responseLength:n,sessionId:null!=c?c:void 0}),[null==t?void 0:t.title,x,n,c]),{isActiveConnection:F,send:W,closeConnect:H}=f({binaryType:"arraybuffer",disabled:!(d&&c),url:V,onMessage:e=>{if("string"==typeof e.data){let t=e.data.trim(),n=t.toLowerCase();if(t.includes("У вас закончились минуты.")){H(),console.log("МИНУТЫ ЗАКОНЧИЛИСЬ В REAL TIME CHAT"),D.current?console.log("403 ошибка уже обработана, пропускаем дублирование toast"):eg({response:{status:403}}),o("Minutes exhausted"),g(),h(!1),G(),S();return}("ping"===n||"pong"===n)&&(console.log("[WS RealTime] heartbeat: ".concat(n," -> pong")),W("pong")),"Запрос обрабатывается..."===t&&o("Message received! Assistant is preparing a response!"),t.includes("<b>Ответ ассистента:</b>")&&o("Connection established");let{isRemainingTime:r,times:s}=ei(e.data);r&&s&&C(s)}I(e.data),R(e.data)},onOpen:()=>{m(),o("Connection established")},onClose:()=>{g(),o("Connection closed"),h(!1),console.log("onClose")},onError:()=>{g(),console.log("Ошибка соединения")}}),{startRecordAudio:O,endRecordAudio:G}=(e=>{let{onResult:t,onError:n,onStream:r}=e,[s,o]=(0,a.useState)(!1),i=(0,a.useRef)(!1),l=(0,a.useRef)(null),c=(0,a.useRef)(null),u=(0,a.useRef)(null),d=(0,a.useRef)(null),h=(0,a.useRef)([]),m=(0,a.useCallback)(e=>{let t=e.length,n=new Int16Array(t);for(let r=0;r<t;r++)n[r]=32767*Math.min(1,e[r]);return n.buffer},[]),g=(0,a.useCallback)(e=>{let t=0;for(let n of e)t+=n.byteLength;let n=new ArrayBuffer(44+t),r=new DataView(n),s=(e,t)=>{for(let n=0;n<t.length;n++)r.setUint8(e+n,t.charCodeAt(n))};s(0,"RIFF"),r.setUint32(4,36+t,!0),s(8,"WAVE"),s(12,"fmt "),r.setUint32(16,16,!0),r.setUint16(20,1,!0),r.setUint16(22,1,!0),r.setUint32(24,16e3,!0),r.setUint32(28,32e3,!0),r.setUint16(32,2,!0),r.setUint16(34,16,!0),s(36,"data"),r.setUint32(40,t,!0);let a=44,o=new Uint8Array(n);for(let t of e){let e=new Uint8Array(t);o.set(e,a),a+=t.byteLength}return new Blob([n],{type:"audio/wav"})},[]),p=(0,a.useCallback)(async()=>{if(!s)try{let e=await navigator.mediaDevices.getUserMedia({audio:{sampleRate:16e3,channelCount:1}});d.current=e;let t=new(window.AudioContext||window.webkitAudioContext);l.current=t;let n=t.createMediaStreamSource(e);u.current=n;let s=t.createScriptProcessor(16384,1,1);c.current=s,h.current=[],s.onaudioprocess=e=>{if(i.current){let t=e.inputBuffer.getChannelData(0),n=m(t);if(h.current.push(n),r){let e=new Blob([n],{type:"audio/pcm"});r({arrayBuffer:n,blob:e})}}},n.connect(s),s.connect(t.destination),o(!0),i.current=!0}catch(t){let e=t instanceof Error?t.message:"Неизвестная ошибка";console.error("❌ Ошибка запуска записи:",e),null==n||n("Ошибка доступа к микрофону: ".concat(e))}},[s,r,n,m]);return{isRecordAudio:s,startRecordAudio:p,endRecordAudio:(0,a.useCallback)(()=>{if(o(!1),i.current=!1,c.current&&(c.current.disconnect(),c.current=null),u.current&&(u.current.disconnect(),u.current=null),l.current&&(l.current.close(),l.current=null),d.current&&(d.current.getTracks().forEach(e=>e.stop()),d.current=null),t&&h.current.length>0){let e=g(h.current);t({voiceBlob:e,wavBlob:e})}h.current=[]},[t,g])}})({onStream:e=>{let{arrayBuffer:t}=e;W(t)}});(0,a.useEffect)(()=>{F||(G(),S())},[F]),(0,a.useEffect)(()=>{N(),S(),G(),F&&H(),h(!1)},[null==t?void 0:t.title,null==e?void 0:e.title,n]);let z=async()=>{if(y){G(),j();return}if(!F){console.log("НЕТ СОЕДИНЕНИЯ В REAL TIME CHAT");try{let{data:e}=await L();if(!e){console.error("Не удалось получить session_id"),o("Ошибка подключения");return}u(e),h(!0)}catch(e){o("Ошибка подключения");return}}b||(P(),_(!0)),O(),j()};return(0,s.jsx)(q,{scrollRef:M,data:E,infoMessage:null!=r?r:"",initChatMessage:A||"Record a voice message to start",timer:w,isRecording:y,endButtonClick:()=>{G(),N(),S(),B(),_(!1),h(!1),H()},handleMicClick:z,isExpanded:i,expandButtonClick:()=>l(!i),children:e=>{switch(e.type){case"text":return(0,s.jsx)(p.cM,{role:e.role,children:e.content},e.id);case"audio":return(0,s.jsx)(p.sv,{ref:t=>{t&&k(e.id,t)},controls:!0,src:e.objectUrl},e.id);default:return null}}})};var ev=n(30412),e_=n.n(ev);let eb=e=>{let{isExpanded:t,expandButtonClick:n,messages:r,isRecording:a,onRecordClick:o,onStopClick:i,initialChatMessage:l,recordingHandlers:c,infoMessage:d,scrollRef:h,children:m}=e;return(0,s.jsx)(W,{scrollRef:h,messagesNode:null==r?void 0:r.map((e,t)=>m(e)),initialChatMessage:l,infoMessage:d,isExpanded:t,topSlot:(0,s.jsxs)("div",{className:e_().action_buttons,children:[(0,s.jsx)(k,{onClick:i}),(0,s.jsx)(z,{isExpanded:t,onClick:n}),(0,s.jsx)(P,{})]}),footerSlot:(0,s.jsx)(u.$n,{variant:a?"secondary":"orange",className:e_().record_button,onClick:o,...c&&{onMouseDown:c.onMouseDown,onMouseUp:c.onMouseUp,onMouseLeave:c.onMouseLeave,onTouchStart:c.onTouchStart,onTouchEnd:c.onTouchEnd,onTouchCancel:c.onTouchCancel},children:a?"\uD83D\uDD34 Recording...":"\uD83C\uDFA4 Hold to record"})})};eb.displayName="VoiceMessagesChatUI";var ex=n(71390);let ey=(0,J.v)()((0,Y.D)(e=>({messages:[],chatStatus:"",addMessage:t=>{e(e=>{e.messages.push(t)})},setChatStatus:t=>{e(e=>{e.chatStatus=t})},clearMessagesStore:()=>{e(e=>{e.messages=[],e.chatStatus=""})}}))),ew=()=>{let[e,t]=(0,a.useState)(""),[n,r]=(0,a.useState)(""),[o,i]=(0,a.useState)(!0),[l,c]=(0,a.useState)(null),[u,d]=(0,a.useState)(!1),h=(0,a.useRef)(null),m=(0,a.useRef)(!1),g=(0,p.wn)(),C=(0,p.Kk)(),_=(0,el.zc)(),b=(0,p.EL)(),x=(0,p.t5)(),{currentTopicTitle:y}=(0,p.LW)(),{messages:w,addVoiceAudioData:j,addVoiceTextMessage:S,clearVoiceMessagesStore:U}=(()=>{let e=ey(e=>e.messages),t=ey(e=>e.chatStatus),n=ey(e=>e.addMessage),r=ey(e=>e.clearMessagesStore),{addChunk:s,finalize:o,hasChunks:i}=et(),{audioStatus:l,onAudioChunk:c}=en(2e3);return(0,a.useEffect)(()=>{if("end sending audio"===l&&i){let e=o();e&&n({id:ee(),role:"assistant",type:"audio",audioData:"",objectUrl:e})}},[l,i,o,n]),{messages:e,chatStatus:t,clearVoiceMessagesStore:r,addVoiceAudioData:e=>{s(e),c()},addVoiceTextMessage:e=>{let t,r;if("string"!=typeof e.data)return;let s=e.data;if(s.includes("<b>Ответ ассистента:</b>"))t="assistant",r=s.replace("<b>Ответ ассистента:</b>","").trim();else{if(!s.includes("<b>Запрос пользователя:</b>"))return;t="user",r=s.replace("<b>Запрос пользователя:</b>","").trim()}n({id:ee(),role:t,type:"text",content:r})},addVoiceMessage:n}})(),{containerRef:N}=er(w,{threshold:100}),{registerAudioRef:E,clearPlayedAudioIds:A,pauseAllAudio:P}=(e=>{let{messages:t,isExpanded:n}=e,[r,s]=(0,a.useState)(null),{isAudioAlreadyPlayed:o,setLastPlayedAudioId:i,clearLastPlayedAudioId:l}=ea(),c=(0,a.useRef)(new Map),u=(0,a.useRef)(t.length),d=(0,a.useCallback)((e,t)=>{c.current.set(e,t)},[]),h=(0,a.useCallback)(()=>{c.current.forEach(e=>{e.paused||e.pause()})},[]);return(0,a.useEffect)(()=>{let e=t.length>u.current;if(u.current=t.length,!e)return;let a=t[t.length-1];if(n)return void i(a.id);if(t.length>0){let e=t.findLast(e=>"assistant"===e.role&&"audio"===e.type);if(e&&"audio"===e.type){if((null==r?void 0:r.id)===e.id&&(null==r?void 0:r.isPLaing)||o(e.id))return;h(),setTimeout(()=>{let t=c.current.get(e.id);t&&(s({id:e.id,isPLaing:!0}),t.onended=()=>{s(null)},t.onpause=()=>{s(e=>e?{...e,isPLaing:!1}:null)},t.onplay=()=>{s(e=>e?{...e,isPLaing:!0}:null)},t.play(),i(e.id))},100)}}},[t,r,h,o,i]),{currentPlayingAudio:r,clearPlayedAudioIds:()=>{l()},registerAudioRef:d,pauseAllAudio:h}})({messages:w,isExpanded:o}),{refetch:R,has403ErrorHandled:M}=eC(),T=(0,a.useMemo)(()=>{var e;return v.J.voiceMessagesWSConnect({voice:null==b?void 0:b.title,topic:y||"",responseLength:null!=(e=null==x?void 0:x.id)?e:"normal",sessionId:null!=l?l:void 0})},[null==b?void 0:b.title,y,null==x?void 0:x.id,l]),{isActiveConnection:k,closeConnect:I,send:B}=f({binaryType:"arraybuffer",disabled:!(u&&l),url:T,onMessage:e=>{if("string"==typeof e.data){let n=e.data.trim(),s=n.toLowerCase();if(n.includes("У вас закончились минуты.")){I(),M.current?console.log("403 ошибка уже обработана, пропускаем дублирование toast"):eg({response:{status:403}}),r("Minutes exhausted"),C(),d(!1),F();return}("ping"===s||"pong"===s)&&(console.log("[WS Voice] heartbeat: ".concat(s," -> pong")),B("pong")),"В обработку принят файл."===n&&r("Message received! Assistant is preparing a response!"),n.includes("<b>Ответ ассистента:</b>")&&r("Connection established");let{isRemainingTime:a,times:o}=ei(e.data);if(a&&o&&_(o),e.data.startsWith("CONNECTED:")){let n=(e=>{try{let t=JSON.parse(e);if(t.message&&t.message.startsWith("CONNECTED:"))return t.message.replace("CONNECTED:","");return null}catch(t){return console.warn("JSON parsing error:",t),console.warn("Plain string received",e),e.replace("CONNECTED:","")}})(e.data);n&&t(n)}else S(e)}e.data instanceof ArrayBuffer&&j(e.data)},onOpen:()=>{m.current=!0,g(),r("Connection established"),h.current&&(h.current.resolve(),h.current=null)},onClose:()=>{m.current=!1,r("Connection closed"),C(),d(!1),h.current&&(h.current.reject(Error("Connection closed")),h.current=null)},onError:e=>{console.error("Voice message chat error:",e),m.current=!1,C(),h.current&&(h.current.reject(Error("Connection error")),h.current=null)}}),{mutate:L}=(0,ex.b)(),D=(0,a.useRef)(null);(0,a.useEffect)(()=>{D.current=l},[l]);let{startRecord:V,endRecord:F,isRecording:W}=(e=>{let{onResult:t,onError:n,onStream:r}=e,[s,o]=(0,a.useState)(!1),i=(0,a.useRef)(null),l=(0,a.useRef)(null),c=(0,a.useRef)([]),u=(0,a.useCallback)(e=>{let t=e.sampleRate,n=e.getChannelData(0),r=2*n.length,s=new ArrayBuffer(44+r),a=new DataView(s),o=(e,t)=>{for(let n=0;n<t.length;n++)a.setUint8(e+n,t.charCodeAt(n))};o(0,"RIFF"),a.setUint32(4,36+r,!0),o(8,"WAVE"),o(12,"fmt "),a.setUint32(16,16,!0),a.setUint16(20,1,!0),a.setUint16(22,1,!0),a.setUint32(24,t,!0),a.setUint32(28,2*t,!0),a.setUint16(32,2,!0),a.setUint16(34,16,!0),o(36,"data"),a.setUint32(40,r,!0);let i=44;for(let e=0;e<n.length;e++,i+=2){let t=Math.max(-1,Math.min(1,n[e]));a.setInt16(i,32767*t,!0)}return new Blob([s],{type:"audio/wav"})},[]),d=(0,a.useCallback)(async e=>{try{let t=new(window.AudioContext||window.webkitAudioContext),n=await e.arrayBuffer(),r=await t.decodeAudioData(n);return t.close(),u(r)}catch(t){return console.error("Ошибка конвертации в WAV:",t),new Blob([e],{type:"audio/wav"})}},[u]),h=(0,a.useCallback)(async()=>{try{let e=await navigator.mediaDevices.getUserMedia({audio:!0});l.current=e;let s=new MediaRecorder(e);i.current=s,c.current=[],s.addEventListener("dataavailable",async e=>{if(e.data.size>0&&(c.current.push(e.data),r)){let t=await e.data.arrayBuffer();r({arrayBuffer:t,blob:e.data})}}),s.addEventListener("stop",async()=>{let e=new Blob(c.current,{type:"audio/webm"}),n=await d(e);null==t||t({voiceBlob:e,wavBlob:n}),l.current&&(l.current.getTracks().forEach(e=>e.stop()),l.current=null),i.current=null,c.current=[],o(!1)}),s.addEventListener("error",e=>{let t="Ошибка MediaRecorder: ".concat(e.error);null==n||n(t),o(!1)})}catch(t){let e=t instanceof Error?t.message:"Неизвестная ошибка";null==n||n("Ошибка доступа к микрофону: ".concat(e))}},[t,n,r,d,u]),m=(0,a.useCallback)(async()=>{var e;if(!s&&(null==(e=i.current)?void 0:e.state)!=="recording")try{await h(),i.current&&"inactive"===i.current.state&&(i.current.start(100),o(!0))}catch(t){let e=t instanceof Error?t.message:"Неизвестная ошибка";null==n||n("Ошибка начала записи: ".concat(e))}},[s,h,n]);return{isRecording:s,startRecord:m,endRecord:(0,a.useCallback)(()=>{i.current&&"recording"===i.current.state&&i.current.stop()},[])}})({onResult:async t=>{if(console.log("onResult вызван, проверяем соединение..."),!await O(5e3)||!D.current)return void console.error("Не удалось дождаться активного соединения или получить sessionId");console.log("Соединение подтверждено, отправляем аудио"),L({wavBlob:t.wavBlob,clientId:e,sessionId:D.current})},onError:e=>{console.error("Ошибка записи:",e)}}),H=async()=>{if(k)return!0;try{let{data:e}=await R();if(!e)return r("Ошибка подключения"),!1;return c(e),D.current=e,d(!0),await new Promise((e,t)=>{h.current={resolve:e,reject:t},setTimeout(()=>{h.current&&(h.current=null,t(Error("Connection timeout")))},5e3)}),!0}catch(e){return r("Ошибка подключения"),!1}},O=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5e3;if(m.current&&D.current)return!0;try{return await new Promise((t,n)=>{let r=Date.now(),s=setInterval(()=>{m.current&&D.current?(clearInterval(s),t()):Date.now()-r>e&&(clearInterval(s),n(Error("Connection timeout")))},50)}),!0}catch(e){return console.error("Ошибка ожидания соединения:",e),!1}},G=async e=>{await H()&&V()},z=async()=>{await H()||console.log("Не удалось установить соединение, клик отменен")},q=()=>{F()},J=async e=>{await H()&&V()},Y=()=>{F()};return(0,a.useEffect)(()=>{k&&I(),d(!1)},[null==b?void 0:b.title,y,null==x?void 0:x.id]),(0,s.jsx)(eb,{scrollRef:N,infoMessage:n,messages:w,isRecording:W,onRecordClick:z,onStopClick:()=>{F(),U(),m.current=!1,d(!1),I(),P(),A()},isExpanded:o,expandButtonClick:()=>i(!o),initialChatMessage:w.length?"":"Hold the button to record a voice message",recordingHandlers:{onMouseDown:G,onMouseUp:q,onMouseLeave:q,onTouchStart:J,onTouchEnd:Y,onTouchCancel:Y},children:e=>"assistant"===e.role&&"audio"===e.type?(0,s.jsx)(p.sv,{ref:t=>{t&&E(e.id,t)},src:e.objectUrl,controls:!0},e.id):"text"===e.type?(0,s.jsx)(p.cM,{role:e.role,children:e.content},e.id):void 0})},ej=()=>{let e=(0,l.useSearchParams)().get("mode");return"realtime"===e?(0,s.jsx)(ef,{}):"voice"===e?(0,s.jsx)(ew,{}):null},eS=e=>{let{className:t}=e,n=(0,l.useRouter)();return(0,l.useSearchParams)().get("mode"),(0,s.jsx)("section",{id:"chat-container",className:(0,c.A)(i().section,t),children:(0,s.jsx)(u.mc,{children:(0,s.jsxs)("div",{className:i().demoContainer,children:[(0,s.jsx)("button",{className:i().closeButton,onClick:()=>n.push(h.J.homePage),type:"button",children:"\xd7"}),(0,s.jsxs)(u.xA,{children:[(0,s.jsxs)("div",{className:i().demoContent,children:[(0,s.jsxs)("div",{className:i().demoHeader,children:[(0,s.jsx)("h1",{className:i().demoTitle,children:"Start conversation right now"}),(0,s.jsx)("p",{className:i().demoDescription,children:"1 minute demo conversation free, no registration"})]}),(0,s.jsx)(C,{}),(0,s.jsx)(ej,{}),(0,s.jsx)("p",{className:i().helpText,children:"Choose a mode to start communication"})]}),(0,s.jsx)("div",{className:i().demoImage,children:(0,s.jsx)(d.y,{})})]})]})})})};eS.displayName="CombinedChatComponent";let eU=e=>(0,s.jsx)(a.Suspense,{fallback:(0,s.jsx)("div",{children:"Loading..."}),children:(0,s.jsx)(eS,{...e})});eU.displayName="CombinedChatComponentWrapper"},75847:(e,t,n)=>{"use strict";n.d(t,{j:()=>s});var r=n(12115);let s=e=>{let{handler:t,attached:n=!0}=e,s=(0,r.useRef)(null),a=(0,r.useRef)(null);return(0,r.useLayoutEffect)(()=>{a.current=t},[t]),(0,r.useEffect)(()=>{if(!n)return;let e=e=>{let t=e.target;if((null==s?void 0:s.current)&&t.isConnected&&!(null==s?void 0:s.current.contains(t))){var n;null==(n=a.current)||n.call(a)}},t=e=>{var t;"Escape"===e.key&&(null==(t=a.current)||t.call(a))};return document.addEventListener("click",e),document.addEventListener("keydown",t),()=>{document.removeEventListener("click",e),document.removeEventListener("keydown",t)}},[s,n]),{elementRef:s}}},79244:e=>{e.exports={modeSelector:"ChangeChatMode_modeSelector__dfvy1",modeTab:"ChangeChatMode_modeTab__KFMNb",active:"ChangeChatMode_active__Wn7tw"}}}]);