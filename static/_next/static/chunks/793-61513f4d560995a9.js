(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[793],{3076:(e,t,n)=>{"use strict";n.d(t,{AuthPage:()=>c});var s=n(95155),r=n(57423),o=n.n(r),a=n(12115),i=n(2821),l=n(13664);let c=e=>{let{className:t}=e,[n,r]=(0,a.useState)("login"),[c,u]=(0,a.useState)(!1),[d,m]=(0,a.useState)(!1),h=e=>{e.preventDefault(),u(!1),m(!1),"login"===n?u(!0):(m(!0),setTimeout(()=>{r("login"),m(!1)},2e3))},g=e=>{alert("".concat(e," authorization (demo)"))};return(0,s.jsx)("div",{className:(0,i.A)(o().page,t),children:(0,s.jsx)("section",{className:o().authSection,children:(0,s.jsx)(l.mc,{children:(0,s.jsx)("div",{className:o().authContainer,children:(0,s.jsx)(l.Zp,{className:o().authCard,padding:"lg",children:"login"===n?(0,s.jsxs)("div",{className:o().authForm,children:[(0,s.jsxs)("div",{className:o().authHeader,children:[(0,s.jsx)("h1",{className:o().authTitle,children:"Welcome to FluentGo"}),(0,s.jsx)("p",{className:o().authDescription,children:"Sign in to your account or register to continue"})]}),(0,s.jsxs)("form",{onSubmit:h,className:o().form,children:[(0,s.jsx)("div",{className:o().inputGroup,children:(0,s.jsx)("input",{type:"email",className:o().input,placeholder:"Enter email",required:!0})}),(0,s.jsx)("div",{className:o().inputGroup,children:(0,s.jsx)("input",{type:"password",className:o().input,placeholder:"Enter password",required:!0})}),c&&(0,s.jsx)("div",{className:o().errorMessage,children:"Invalid email or password"}),(0,s.jsx)(l.$n,{type:"submit",variant:"primary",className:o().submitButton,children:"Sign In"})]}),(0,s.jsx)("div",{className:o().forgotPassword,children:(0,s.jsx)("button",{type:"button",className:o().forgotLink,onClick:()=>alert("Password recovery feature (in development)"),children:"Forgot password?"})}),(0,s.jsx)("div",{className:o().divider,children:(0,s.jsx)("span",{children:"or"})}),(0,s.jsx)(l.$n,{variant:"secondary",className:o().switchButton,onClick:()=>r("register"),children:"Register"}),(0,s.jsxs)("div",{className:o().socialButtons,children:[(0,s.jsxs)("button",{className:o().socialButton,onClick:()=>g("Google"),type:"button",children:[(0,s.jsxs)("svg",{className:o().socialIcon,viewBox:"0 0 24 24",children:[(0,s.jsx)("path",{fill:"#4285F4",d:"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"}),(0,s.jsx)("path",{fill:"#34A853",d:"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"}),(0,s.jsx)("path",{fill:"#FBBC05",d:"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"}),(0,s.jsx)("path",{fill:"#EA4335",d:"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"})]}),(0,s.jsx)("span",{children:"Sign in with Google"})]}),(0,s.jsxs)("button",{className:o().socialButton,onClick:()=>g("Facebook"),type:"button",children:[(0,s.jsx)("svg",{className:o().socialIcon,fill:"#1877F2",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{d:"M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"})}),(0,s.jsx)("span",{children:"Sign in with Facebook"})]})]})]}):(0,s.jsxs)("div",{className:o().authForm,children:[(0,s.jsxs)("div",{className:o().authHeader,children:[(0,s.jsx)("h1",{className:o().authTitle,children:"Create Account"}),(0,s.jsx)("p",{className:o().authDescription,children:"Fill out the form to register"})]}),(0,s.jsxs)("form",{onSubmit:h,className:o().form,children:[(0,s.jsx)("div",{className:o().inputGroup,children:(0,s.jsx)("input",{type:"text",className:o().input,placeholder:"Enter name",required:!0})}),(0,s.jsx)("div",{className:o().inputGroup,children:(0,s.jsx)("input",{type:"email",className:o().input,placeholder:"Enter email",required:!0})}),(0,s.jsx)("div",{className:o().inputGroup,children:(0,s.jsx)("input",{type:"password",className:o().input,placeholder:"Enter password",required:!0})}),(0,s.jsx)("div",{className:o().inputGroup,children:(0,s.jsx)("input",{type:"password",className:o().input,placeholder:"Confirm password",required:!0})}),d&&(0,s.jsx)("div",{className:o().successMessage,children:"Account created! You can now log in"}),(0,s.jsx)(l.$n,{type:"submit",variant:"primary",className:o().submitButton,children:"Create Account"})]}),(0,s.jsx)("div",{className:o().divider,children:(0,s.jsx)("span",{children:"or"})}),(0,s.jsx)(l.$n,{variant:"secondary",className:o().switchButton,onClick:()=>r("login"),children:"Already have an account? Sign In"})]})})})})})})};c.displayName="AuthPage"},13203:e=>{e.exports={controls:"RealTimeChatUI_controls___xVXa",micSection:"RealTimeChatUI_micSection__3lV_b",statusSection:"RealTimeChatUI_statusSection__uBjsR",statusText:"RealTimeChatUI_statusText__uJvYt",timer:"RealTimeChatUI_timer__ZbLPu",actionButtons:"RealTimeChatUI_actionButtons__dFgtV"}},20708:e=>{e.exports={chat_wrapper:"ChatWindow_chat_wrapper__5_GGR",chat_window:"ChatWindow_chat_window__2a6p8",initial_message:"ChatWindow_initial_message__ntJUV",info_message:"ChatWindow_info_message__7yyI_"}},21042:(e,t,n)=>{"use strict";n.d(t,{MainPage:()=>o});var s=n(95155),r=n(62730);let o=()=>(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(r.KE,{}),(0,s.jsx)(r.zF,{}),(0,s.jsx)(r.bz,{}),(0,s.jsx)(r.Ti,{}),(0,s.jsx)(r.ik,{}),(0,s.jsx)(r.X3,{}),(0,s.jsx)(r.cF,{}),(0,s.jsx)(r.Bw,{}),(0,s.jsx)(r.P8,{})]});o.displayName="MainPage"},24598:()=>{},26366:(e,t,n)=>{"use strict";let s;n.d(t,{CombinedChatComponentWrapper:()=>ew});var r=n(95155),o=n(12115),a=n(49780),i=n.n(a),l=n(20063),c=n(2821),u=n(13664),d=n(9815),m=n(82267),h=n(34768),g=n(52321),p=n(79244),C=n.n(p),_=n(63782);let v=()=>{let e=(0,l.useSearchParams)().get("mode"),t=(0,l.useRouter)();(0,_.pD)();let n=(0,h.Ym)();return(0,r.jsxs)("div",{className:C().modeSelector,children:[(0,r.jsx)("button",{className:(0,c.A)(C().modeTab,{[C().active]:"realtime"===e}),onClick:()=>t.push((0,g.c)(m.J.chatPage.chatPageRealtime,n)),type:"button",children:"Real Time"}),(0,r.jsx)("button",{className:(0,c.A)(C().modeTab,{[C().active]:"voice"===e}),onClick:()=>t.push((0,g.c)(m.J.chatPage.chatPageVoice,n)),type:"button",children:"Voice Messages"})]})};v.displayName="ChangeChatMode";let f=e=>{let{url:t,binaryType:n,disabled:s,...r}=e,[a,i]=(0,o.useState)(!1),l=(0,o.useRef)(null),c=function(e){let t=(0,o.useRef)(e);return(0,o.useLayoutEffect)(()=>{t.current=e},[e]),t}(r),u=(0,o.useCallback)(e=>{l.current&&l.current.readyState===WebSocket.OPEN&&l.current.send(e)},[]),d=(0,o.useCallback)(()=>{console.log("createConnection",s),!s&&(l.current=new WebSocket(t),l.current&&(n&&(l.current.binaryType=n),l.current.onopen=()=>{var e,t;null==(e=(t=c.current).onOpen)||e.call(t),i(!0)},l.current.onmessage=e=>{var t,n;null==(t=(n=c.current).onMessage)||t.call(n,e)},l.current.onclose=()=>{var e,t;null==(e=(t=c.current).onClose)||e.call(t),i(!1)},l.current.onerror=e=>{var t,n;null==(t=(n=c.current).onError)||t.call(n,e),i(!1)}))},[t,n,s]);return(0,o.useEffect)(()=>(d(),()=>{var e;console.log("закрытие соединения"),null==(e=l.current)||e.close(),l.current=null}),[d]),{closeConnect:()=>{if(l.current){if(l.current.readyState===WebSocket.OPEN||l.current.readyState===WebSocket.CONNECTING){var e,t;l.current.close(),null==(e=(t=c.current).onClose)||e.call(t)}i(!1)}},send:u,createConnection:d,isActiveConnection:a,wsRef:l}};var b=n(1685),x=n(13203),y=n.n(x),j=n(44627),S=n.n(j);let N=e=>{let{isRecording:t=!1,className:n,onClick:s}=e;return(0,r.jsx)("button",{className:(0,c.A)(S().micButton,{[S().active]:t},n),onClick:s,type:"button",children:"\uD83C\uDFA4"})};N.displayName="MicButton";var P=n(23261),w=n(31628),U=n.n(w);let E=()=>(0,r.jsx)("div",{className:U().modal,children:"Please log in to change settings"});E.displayName="NotAuthModal";var M=n(55302),A=n(66171);let R=e=>{let t=(0,A.r8)();return(0,r.jsx)(M.ShowSlotComponent,{position:"center",mode:t?"click":"hover",slot:t?(0,r.jsx)(P.K,{}):(0,r.jsx)(E,{}),children:(0,r.jsx)(u.CS,{opacity:!t,...e})})};R.displayName="ChatSettingButton";var I=n(55548),T=n.n(I),k=n(81479);let B=e=>{let{className:t,onClick:n}=e;return(0,r.jsx)(k.Y,{variant:"danger",as:"button",onClick:n,className:(0,c.A)(T().endButton,t),children:"End"})};B.displayName="EndButton";var D=n(40012),L=n.n(D),V=n(20708),W=n.n(V),F=n(61689);let O=e=>{let{initialChatMessage:t,infoMessage:n,messagesNode:s,scrollRef:o,isExpanded:a=!0}=e;return(0,r.jsxs)(F.P.div,{ref:o,className:W().chat_wrapper,initial:{height:"200px"},animate:{height:a?"200px":"0px",opacity:+!!a},transition:{duration:.3,ease:"easeInOut"},style:{overflow:a?"auto":"hidden"},children:[t&&(0,r.jsx)("span",{className:W().initial_message,children:t}),(0,r.jsx)("div",{className:W().chat_window,children:s}),n&&!t&&(0,r.jsx)("p",{className:W().info_message,children:n})]})};O.displayName="ChatWindow";let G=e=>{let{topSlot:t,footerSlot:n,infoMessage:s,initialChatMessage:o,messagesNode:a,scrollRef:i,className:l,isExpanded:u}=e;return(0,r.jsxs)("div",{className:(0,c.A)(L().chatContainer,l),children:[t,(0,r.jsx)(O,{scrollRef:i,messagesNode:a,infoMessage:s,initialChatMessage:o,isExpanded:u}),!!n&&(0,r.jsx)("div",{className:L().footer_slot,children:n})]})};G.displayName="ChatContainer";var H=n(24598),q=n.n(H);let z={collapsed:"Expand",expanded:"Collapse"},J=e=>{let{isExpanded:t,className:n,onClick:s}=e;return t?z.expanded:z.collapsed,z.collapsed.length,z.expanded.length,(0,r.jsx)(k.Y,{variant:"standart",as:"button",onClick:s,className:(0,c.A)(q().expandButton,n),children:t?"Collapse":"Expand"})};J.displayName="ExpandButton";let Y=e=>{let{isRecording:t,isExpanded:n,timer:s,data:o,initChatMessage:a,infoMessage:i,scrollRef:l,children:c,endButtonClick:u,handleMicClick:d,expandButtonClick:m}=e,h=null==o?void 0:o.map((e,t)=>null==c?void 0:c(e,t));return(0,r.jsx)(G,{scrollRef:l,messagesNode:h,infoMessage:i,initialChatMessage:(null==o?void 0:o.length)?"":a,isExpanded:n,topSlot:(0,r.jsxs)("div",{className:y().controls,children:[(0,r.jsxs)("div",{className:y().micSection,children:[(0,r.jsx)(N,{isRecording:t,onClick:d}),(0,r.jsxs)("div",{className:y().statusSection,children:[(0,r.jsx)("div",{className:y().statusText,children:t?"Listening... Speak now":"Start speaking — assistant is listening"}),(0,r.jsx)("div",{className:y().timer,children:(e=>{let t=Math.floor(e/60);return"".concat(t.toString().padStart(2,"0"),":").concat((e%60).toString().padStart(2,"0"))})(s)})]})]}),(0,r.jsxs)("div",{className:y().actionButtons,children:[(0,r.jsx)(B,{onClick:u}),(0,r.jsx)(J,{isExpanded:n,onClick:m}),(0,r.jsx)(R,{})]})]})})};Y.displayName="RealTimeChatUI";var K=n(25959),$=n(58270);let Z=(0,K.v)()((0,$.D)(e=>({messages:[],chatStatus:"",isActiveSession:!0,addMessage:t=>{e(e=>{e.messages.push(t)})},setIsActiveSession:t=>{e(e=>{e.isActiveSession=t})},setChatStatus:t=>{e(e=>{e.chatStatus=t})},clearMessagesStore:()=>{e(e=>{e.messages=[],e.chatStatus=""})}}))),Q=()=>Z(e=>e.isActiveSession),X={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)},ee=new Uint8Array(16),et=[];for(let e=0;e<256;++e)et.push((e+256).toString(16).slice(1));let en=function(e,t,n){if(X.randomUUID&&!t&&!e)return X.randomUUID();var r=e,o=n;let a=(r=r||{}).random??r.rng?.()??function(){if(!s){if("undefined"==typeof crypto||!crypto.getRandomValues)throw Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");s=crypto.getRandomValues.bind(crypto)}return s(ee)}();if(a.length<16)throw Error("Random bytes length must be >= 16");if(a[6]=15&a[6]|64,a[8]=63&a[8]|128,t){if((o=o||0)<0||o+16>t.length)throw RangeError(`UUID byte range ${o}:${o+15} is out of buffer bounds`);for(let e=0;e<16;++e)t[o+e]=a[e];return t}return function(e,t=0){return(et[e[t+0]]+et[e[t+1]]+et[e[t+2]]+et[e[t+3]]+"-"+et[e[t+4]]+et[e[t+5]]+"-"+et[e[t+6]]+et[e[t+7]]+"-"+et[e[t+8]]+et[e[t+9]]+"-"+et[e[t+10]]+et[e[t+11]]+et[e[t+12]]+et[e[t+13]]+et[e[t+14]]+et[e[t+15]]).toLowerCase()}(a)};function es(){let e=(0,o.useRef)([]),[t,n]=(0,o.useState)(!1),[s,r]=(0,o.useState)(0),a=(0,o.useCallback)(t=>{let s=new DataView(t),o=String.fromCharCode(s.getUint8(0),s.getUint8(1),s.getUint8(2),s.getUint8(3)),a=String.fromCharCode(s.getUint8(8),s.getUint8(9),s.getUint8(10),s.getUint8(11));if("RIFF"!==o||"WAVE"!==a)return void console.warn("Получен не WAV файл или поврежденный заголовок");e.current.push(t),n(!0),r(e.current.length)},[]),i=(0,o.useCallback)(()=>{if(0===e.current.length)return null;try{let t=function(e){if(0===e.length)throw Error("Нет данных для объединения");if(1===e.length)return e[0];let t=function(e){let t=new DataView(e),n=12;for(;n<e.byteLength-8;){let e=String.fromCharCode(t.getUint8(n),t.getUint8(n+1),t.getUint8(n+2),t.getUint8(n+3)),s=t.getUint32(n+4,!0);if("fmt "===e)return{audioFormat:t.getUint16(n+8,!0),channels:t.getUint16(n+10,!0),sampleRate:t.getUint32(n+12,!0),byteRate:t.getUint32(n+16,!0),blockAlign:t.getUint16(n+20,!0),bitsPerSample:t.getUint16(n+22,!0)};n+=8+s}return null}(e[0]);if(!t)throw Error("Не удалось прочитать параметры WAV файла");let n=[],s=0;for(let t of e){let e=function(e){let t=new DataView(e),n=12;for(;n<e.byteLength-8;){let s=String.fromCharCode(t.getUint8(n),t.getUint8(n+1),t.getUint8(n+2),t.getUint8(n+3)),r=t.getUint32(n+4,!0);if("data"===s)return console.log("Извлечено ".concat(r," байт аудио данных")),new Uint8Array(e,n+8,r);if((n+=8+r)>=e.byteLength)break}throw console.error("Структура WAV файла:"),console.error("Первые 50 байт:",new Uint8Array(e.slice(0,50))),Error("Data chunk не найден в WAV файле")}(t);n.push(e),s+=e.length}let r=function(e,t,n,s){let r=new ArrayBuffer(44),o=new DataView(r);return o.setUint8(0,82),o.setUint8(1,73),o.setUint8(2,70),o.setUint8(3,70),o.setUint32(4,36+e,!0),o.setUint8(8,87),o.setUint8(9,65),o.setUint8(10,86),o.setUint8(11,69),o.setUint8(12,102),o.setUint8(13,109),o.setUint8(14,116),o.setUint8(15,32),o.setUint32(16,16,!0),o.setUint16(20,1,!0),o.setUint16(22,n,!0),o.setUint32(24,t,!0),o.setUint32(28,t*n*s/8,!0),o.setUint16(32,n*s/8,!0),o.setUint16(34,s,!0),o.setUint8(36,100),o.setUint8(37,97),o.setUint8(38,116),o.setUint8(39,97),o.setUint32(40,e,!0),new Uint8Array(r)}(s,t.sampleRate,t.channels,t.bitsPerSample),o=new Uint8Array(r.length+s);o.set(r,0);let a=r.length;for(let e of n)o.set(e,a),a+=e.length;return o.buffer}(e.current),s=new Blob([t],{type:"audio/wav"}),o=URL.createObjectURL(s),a=new DataView(t);return String.fromCharCode(a.getUint8(0),a.getUint8(1),a.getUint8(2),a.getUint8(3)),String.fromCharCode(a.getUint8(8),a.getUint8(9),a.getUint8(10),a.getUint8(11)),e.current=[],n(!1),r(0),o}catch(e){return console.error("Ошибка при объединении WAV файлов:",e),null}},[]);return{addChunk:a,finalize:i,reset:(0,o.useCallback)(()=>{e.current=[],n(!1),r(0),console.log("Буфер аудио очищен")},[]),hasChunks:t,chunksCount:s}}let er={VOICE_DETECTED:"Voice detected. Clearing playback queue.",USER_TIMES_REMAINING:"<b>Минут осталось:</b>"},eo=(0,K.v)((e,t)=>({lastPlayedAudioId:null,setLastPlayedAudioId:t=>{e({lastPlayedAudioId:t})},clearLastPlayedAudioId:()=>{e({lastPlayedAudioId:null})},isAudioAlreadyPlayed:e=>{let{lastPlayedAudioId:n}=t();return n===e}})),ea=(0,K.v)()((0,$.D)(e=>({isRecording:!1,timer:0,setIsRecording:t=>{e(e=>{e.isRecording=t})},setTimer:t=>{e(e=>{e.timer=t})},incrementTimer:()=>{e(e=>{e.timer+=1})},toggleMic:()=>{e(e=>{e.isRecording=!e.isRecording})},stopRecording:()=>{e(e=>{e.isRecording=!1})},startRecording:()=>{e(e=>{e.isRecording=!0})},resetTimer:()=>{e(e=>{e.timer=0})},recordVoiceMessage:()=>{e(e=>{e.isRecording||(e.isRecording=!0)})},timerReset:()=>{e(e=>{e.timer=0})}}))),ei=e=>{try{if(!e.includes(er.USER_TIMES_REMAINING))return{isRemainingTime:!1,times:null};let t=e.replace(er.USER_TIMES_REMAINING,"").trim(),n=parseInt(t,10);if(isNaN(n))return{isRemainingTime:!0,times:null};return{isRemainingTime:!0,times:n}}catch(e){return console.error("Ошибка парсинга времени из WebSocket сообщения:",e),{isRemainingTime:!1,times:null}}};var el=n(69504),ec=n(96105),eu=n(39556),ed=n(22454),em=n(94525);let eh={getSessionId:"getSessionId"};var eg=n(22663);let ep=e=>{var t;403===(null==e||null==(t=e.response)?void 0:t.status)&&((0,eg.Ay)("Your minutes have run out. Please renew your subscription ⛔",{duration:6e3,position:"top-center"}),setTimeout(()=>{let e=document.querySelector("#pricing");e&&e.scrollIntoView({behavior:"smooth"})},1e3))};var eC=n(84564);let e_=()=>{let e=(0,o.useRef)(!1),t=(0,ed.I)({queryKey:[eh.getSessionId],queryFn:async()=>(e.current=!1,await em.F.get(b.J.getSessionId).json()),select:e=>e.session_id,retry:!1,enabled:!1});return(0,o.useEffect)(()=>{t.isError&&t.error&&(t.error instanceof eC.H&&403===t.error.response.status&&(e.current=!0),ep(t.error))},[t.isError,t.error]),{...t,has403ErrorHandled:e}},ev=()=>{let e=(0,_.Jc)(),t=(0,_.EL)(),n=(0,_.GT)(),[s,a]=(0,o.useState)(""),[i,l]=(0,o.useState)(!0),[c,u]=(0,o.useState)(null),[d,m]=(0,o.useState)(!1),g=(0,_.wn)(),p=(0,_.Kk)(),C=(0,el.zc)(),v=Z(e=>e.setIsActiveSession),x=Q(),{currentTopicTitle:y}=(0,ec.L)(),{isRecording:j,timer:S,toggleMic:N,stopRecording:P,startRecording:w,resetTimer:U}=(()=>{let e=ea(e=>e.isRecording),t=ea(e=>e.timer),n=ea(e=>e.toggleMic),s=ea(e=>e.stopRecording),r=ea(e=>e.startRecording),a=ea(e=>e.incrementTimer),i=ea(e=>e.resetTimer),l=(0,o.useRef)(null);return(0,o.useEffect)(()=>(e?l.current=setInterval(()=>{a()},1e3):l.current&&(clearInterval(l.current),l.current=null),()=>{l.current&&(clearInterval(l.current),l.current=null)}),[e,a]),{isRecording:e,timer:t,toggleMic:n,stopRecording:s,startRecording:r,resetTimer:i}})(),{messages:E,chatStatus:M,clearMessagesStore:A,addMessage:R}=(()=>{let e=Z(e=>e.messages),t=Z(e=>e.chatStatus),n=Q(),s=Z(e=>e.addMessage),r=Z(e=>e.clearMessagesStore),{addChunk:a,finalize:i,hasChunks:l}=es(),{audioStatus:c,onAudioChunk:u}=(0,h.hq)(2e3);(0,o.useEffect)(()=>{if("end sending audio"===c&&l){let e=i();e&&s({id:en(),audioData:new ArrayBuffer(0),objectUrl:e,role:"assistant",type:"audio"})}},[c,l,i,s]);let d=(0,o.useCallback)(e=>{try{let t=JSON.parse(e).message;if(!t)return;let n=t.match(/<b>Запрос пользователя:<\/b>\s*(.+)/),r=t.match(/<b>Ответ ассистента:<\/b>\s*(.+)/);if(n||r){let e={id:en(),content:((null==n?void 0:n[1])||(null==r?void 0:r[1])||"").trim(),role:n?"user":"assistant",type:"text"};s(e)}}catch(r){let t=e.match(/<b>Запрос пользователя:<\/b>\s*(.+)/),n=e.match(/<b>Ответ ассистента:<\/b>\s*(.+)/);(t||n)&&s({id:en(),content:((null==t?void 0:t[1])||(null==n?void 0:n[1])||"").trim(),role:t?"user":"assistant",type:"text"})}},[s]);return{messages:e,chatStatus:t,clearMessagesStore:r,addMessage:(0,o.useCallback)(e=>{n&&("string"==typeof e&&d(e),e instanceof ArrayBuffer&&(u(),a(e)))},[a,d,u,n])}})(),{containerRef:I}=(0,eu.i)(E,{threshold:100}),{clearPlayedAudioIds:T,registerAudioRef:k,stopPlaingAudioMessageIfUserVoiceDiscovered:B,pauseAllAudio:D}=(e=>{let{messages:t}=e,[n,s]=(0,o.useState)(null),{isAudioAlreadyPlayed:r,setLastPlayedAudioId:a,clearLastPlayedAudioId:i}=eo(),l=(0,o.useRef)(new Map),c=(0,o.useCallback)((e,t)=>{l.current.set(e,t)},[]),u=(0,o.useCallback)(()=>{l.current.forEach(e=>{e.paused||e.pause()})},[]),d=(0,o.useCallback)(()=>{if(null==n?void 0:n.isPLaing){let e=l.current.get(n.id);e&&!e.paused&&(e.pause(),s(null))}},[n]),m=(0,o.useCallback)(e=>{if("string"==typeof e)try{JSON.parse(e).message===er.VOICE_DETECTED&&d()}catch(t){e===er.VOICE_DETECTED&&d()}},[d]);return(0,o.useEffect)(()=>{if(t.length>0){let e=t.findLast(e=>"assistant"===e.role&&"audio"===e.type);if(e&&"audio"===e.type){if((null==n?void 0:n.id)===e.id&&(null==n?void 0:n.isPLaing)||r(e.id))return;u(),setTimeout(()=>{let t=l.current.get(e.id);t&&(s({id:e.id,isPLaing:!0}),t.onended=()=>{s(null)},t.onpause=()=>{s(e=>e?{...e,isPLaing:!1}:null)},t.onplay=()=>{s(e=>e?{...e,isPLaing:!0}:null)},t.play(),a(e.id))},100)}}},[t,n,u,r,a]),{currentPlayingAudio:n,clearPlayedAudioIds:()=>{i()},registerAudioRef:c,pauseCurrentAudio:d,stopPlaingAudioMessageIfUserVoiceDiscovered:m,pauseAllAudio:u}})({messages:E}),{refetch:L,has403ErrorHandled:V}=e_(),W=(0,o.useMemo)(()=>b.J.realTimeChatWSConnect({voice:null==t?void 0:t.title,topic:null!=y?y:"",responseLength:n,sessionId:null!=c?c:void 0}),[null==t?void 0:t.title,y,n,c]),{isActiveConnection:F,send:O,closeConnect:G}=f({binaryType:"arraybuffer",disabled:!(d&&c),url:W,onMessage:e=>{if("string"==typeof e.data){let t=e.data.trim(),n=t.toLowerCase();if(t.includes("У вас закончились минуты.")){G(),console.log("МИНУТЫ ЗАКОНЧИЛИСЬ В REAL TIME CHAT"),V.current?console.log("403 ошибка уже обработана, пропускаем дублирование toast"):ep({response:{status:403}}),a("Minutes exhausted"),p(),m(!1),q(),P();return}("ping"===n||"pong"===n)&&(console.log("[WS RealTime] heartbeat: ".concat(n," -> pong")),O("pong")),"Запрос обрабатывается..."===t&&a("Message received! Assistant is preparing a response!"),t.includes("<b>Ответ ассистента:</b>")&&a("Connection established");let{isRemainingTime:s,times:r}=ei(e.data);s&&r&&C(r)}B(e.data),R(e.data)},onOpen:()=>{g(),a("Connection established")},onClose:()=>{p(),a("Connection closed"),m(!1),console.log("onClose")},onError:()=>{p(),console.log("Ошибка соединения")}}),{startRecordAudio:H,endRecordAudio:q}=(0,h.qv)({onStream:e=>{let{arrayBuffer:t}=e;O(t)}});(0,o.useEffect)(()=>{F||(q(),P())},[F]),(0,o.useEffect)(()=>{U(),P(),q(),F&&G(),m(!1)},[null==t?void 0:t.title,null==e?void 0:e.title,n]);let z=async()=>{if(j){q(),N();return}if(!F){console.log("НЕТ СОЕДИНЕНИЯ В REAL TIME CHAT");try{let{data:e}=await L();if(!e){console.error("Не удалось получить session_id"),a("Ошибка подключения");return}u(e),m(!0)}catch(e){a("Ошибка подключения");return}}x||(A(),v(!0)),H(),N()};return(0,r.jsx)(Y,{scrollRef:I,data:E,infoMessage:null!=s?s:"",initChatMessage:M||"Record a voice message to start",timer:S,isRecording:j,endButtonClick:()=>{q(),U(),P(),D(),v(!1),m(!1),G()},handleMicClick:z,isExpanded:i,expandButtonClick:()=>l(!i),children:e=>{switch(e.type){case"text":return(0,r.jsx)(_.cM,{role:e.role,children:e.content},e.id);case"audio":return(0,r.jsx)(_.sv,{ref:t=>{t&&k(e.id,t)},controls:!0,src:e.objectUrl},e.id);default:return null}}})};var ef=n(30412),eb=n.n(ef);let ex=e=>{let{isExpanded:t,messages:n,isRecording:s,initialChatMessage:o,recordingHandlers:a,infoMessage:i,scrollRef:l,children:c,expandButtonClick:d,onRecordClick:m,onStopClick:h}=e;return(0,r.jsx)(G,{scrollRef:l,messagesNode:null==n?void 0:n.map((e,t)=>c(e)),initialChatMessage:o,infoMessage:i,isExpanded:t,topSlot:(0,r.jsxs)("div",{className:eb().action_buttons,children:[(0,r.jsx)(B,{onClick:h}),(0,r.jsx)(J,{isExpanded:t,onClick:d}),(0,r.jsx)(R,{})]}),footerSlot:(0,r.jsx)(u.$n,{variant:s?"secondary":"orange",className:eb().record_button,onClick:m,...a&&{onMouseDown:a.onMouseDown,onMouseUp:a.onMouseUp,onMouseLeave:a.onMouseLeave,onTouchStart:a.onTouchStart,onTouchEnd:a.onTouchEnd,onTouchCancel:a.onTouchCancel},children:s?"\uD83D\uDD34 Recording...":"\uD83C\uDFA4 Hold to record"})})};ex.displayName="VoiceMessagesChatUI";var ey=n(71390);let ej=(0,K.v)()((0,$.D)(e=>({messages:[],chatStatus:"",addMessage:t=>{e(e=>{e.messages.push(t)})},setChatStatus:t=>{e(e=>{e.chatStatus=t})},clearMessagesStore:()=>{e(e=>{e.messages=[],e.chatStatus=""})}}))),eS=()=>{let[e,t]=(0,o.useState)(""),[n,s]=(0,o.useState)(""),[a,i]=(0,o.useState)(!0),[l,c]=(0,o.useState)(null),[u,d]=(0,o.useState)(!1),m=(0,o.useRef)(null),g=(0,o.useRef)(!1),p=(0,_.wn)(),C=(0,_.Kk)(),v=(0,el.zc)(),x=(0,_.EL)(),y=(0,_.t5)(),{currentTopicTitle:j}=(0,_.LW)(),{messages:S,addVoiceAudioData:N,addVoiceTextMessage:P,clearVoiceMessagesStore:w}=(()=>{let e=ej(e=>e.messages),t=ej(e=>e.chatStatus),n=ej(e=>e.addMessage),s=ej(e=>e.clearMessagesStore),{addChunk:r,finalize:a,hasChunks:i}=es(),{audioStatus:l,onAudioChunk:c}=(0,h.hq)(2e3);return(0,o.useEffect)(()=>{if("end sending audio"===l&&i){let e=a();e&&n({id:en(),role:"assistant",type:"audio",audioData:"",objectUrl:e})}},[l,i,a,n]),{messages:e,chatStatus:t,clearVoiceMessagesStore:s,addVoiceAudioData:e=>{r(e),c()},addVoiceTextMessage:e=>{let t,s;if("string"!=typeof e.data)return;let r=e.data;if(r.includes("<b>Ответ ассистента:</b>"))t="assistant",s=r.replace("<b>Ответ ассистента:</b>","").trim();else{if(!r.includes("<b>Запрос пользователя:</b>"))return;t="user",s=r.replace("<b>Запрос пользователя:</b>","").trim()}n({id:en(),role:t,type:"text",content:s})},addVoiceMessage:n}})(),{containerRef:U}=(0,eu.i)(S,{threshold:100}),{registerAudioRef:E,clearPlayedAudioIds:M,pauseAllAudio:A}=(e=>{let{messages:t,isExpanded:n}=e,[s,r]=(0,o.useState)(null),{isAudioAlreadyPlayed:a,setLastPlayedAudioId:i,clearLastPlayedAudioId:l}=eo(),c=(0,o.useRef)(new Map),u=(0,o.useRef)(t.length),d=(0,o.useCallback)((e,t)=>{c.current.set(e,t)},[]),m=(0,o.useCallback)(()=>{c.current.forEach(e=>{e.paused||e.pause()})},[]);return(0,o.useEffect)(()=>{let e=t.length>u.current;if(u.current=t.length,!e)return;let o=t[t.length-1];if(n)return void i(o.id);if(t.length>0){let e=t.findLast(e=>"assistant"===e.role&&"audio"===e.type);if(e&&"audio"===e.type){if((null==s?void 0:s.id)===e.id&&(null==s?void 0:s.isPLaing)||a(e.id))return;m(),setTimeout(()=>{let t=c.current.get(e.id);t&&(r({id:e.id,isPLaing:!0}),t.onended=()=>{r(null)},t.onpause=()=>{r(e=>e?{...e,isPLaing:!1}:null)},t.onplay=()=>{r(e=>e?{...e,isPLaing:!0}:null)},t.play(),i(e.id))},100)}}},[t,s,m,a,i]),{currentPlayingAudio:s,clearPlayedAudioIds:()=>{l()},registerAudioRef:d,pauseAllAudio:m}})({messages:S,isExpanded:a}),{refetch:R,has403ErrorHandled:I}=e_(),T=(0,o.useMemo)(()=>{var e;return b.J.voiceMessagesWSConnect({voice:null==x?void 0:x.title,topic:j||"",responseLength:null!=(e=null==y?void 0:y.id)?e:"normal",sessionId:null!=l?l:void 0})},[null==x?void 0:x.title,j,null==y?void 0:y.id,l]),{isActiveConnection:k,closeConnect:B,send:D}=f({binaryType:"arraybuffer",disabled:!(u&&l),url:T,onMessage:e=>{if("string"==typeof e.data){let n=e.data.trim(),r=n.toLowerCase();if(n.includes("У вас закончились минуты.")){B(),I.current?console.log("403 ошибка уже обработана, пропускаем дублирование toast"):ep({response:{status:403}}),s("Minutes exhausted"),C(),d(!1),F();return}("ping"===r||"pong"===r)&&(console.log("[WS Voice] heartbeat: ".concat(r," -> pong")),D("pong")),"В обработку принят файл."===n&&s("Message received! Assistant is preparing a response!"),n.includes("<b>Ответ ассистента:</b>")&&s("Connection established");let{isRemainingTime:o,times:a}=ei(e.data);if(o&&a&&v(a),e.data.startsWith("CONNECTED:")){let n=(e=>{try{let t=JSON.parse(e);if(t.message&&t.message.startsWith("CONNECTED:"))return t.message.replace("CONNECTED:","");return null}catch(t){return console.warn("JSON parsing error:",t),console.warn("Plain string received",e),e.replace("CONNECTED:","")}})(e.data);n&&t(n)}else P(e)}e.data instanceof ArrayBuffer&&N(e.data)},onOpen:()=>{g.current=!0,p(),s("Connection established"),m.current&&(m.current.resolve(),m.current=null)},onClose:()=>{g.current=!1,s("Connection closed"),C(),d(!1),m.current&&(m.current.reject(Error("Connection closed")),m.current=null)},onError:e=>{console.error("Voice message chat error:",e),g.current=!1,C(),m.current&&(m.current.reject(Error("Connection error")),m.current=null)}}),{mutate:L}=(0,ey.b)(),V=(0,o.useRef)(null);(0,o.useEffect)(()=>{V.current=l},[l]);let{startRecord:W,endRecord:F,isRecording:O}=(0,h.CM)({onResult:async t=>{if(console.log("onResult вызван, проверяем соединение..."),!await H(5e3)||!V.current)return void console.error("Не удалось дождаться активного соединения или получить sessionId");console.log("Соединение подтверждено, отправляем аудио"),L({wavBlob:t.wavBlob,clientId:e,sessionId:V.current})},onError:e=>{console.error("Ошибка записи:",e)}}),G=async()=>{if(k)return!0;try{let{data:e}=await R();if(!e)return s("Ошибка подключения"),!1;return c(e),V.current=e,d(!0),await new Promise((e,t)=>{m.current={resolve:e,reject:t},setTimeout(()=>{m.current&&(m.current=null,t(Error("Connection timeout")))},5e3)}),!0}catch(e){return s("Ошибка подключения"),!1}},H=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5e3;if(g.current&&V.current)return!0;try{return await new Promise((t,n)=>{let s=Date.now(),r=setInterval(()=>{g.current&&V.current?(clearInterval(r),t()):Date.now()-s>e&&(clearInterval(r),n(Error("Connection timeout")))},50)}),!0}catch(e){return console.error("Ошибка ожидания соединения:",e),!1}},q=async e=>{await G()&&W()},z=async()=>{await G()||console.log("Не удалось установить соединение, клик отменен")},J=()=>{F()},Y=async e=>{await G()&&W()},K=()=>{F()};return(0,o.useEffect)(()=>{k&&B(),d(!1)},[null==x?void 0:x.title,j,null==y?void 0:y.id]),(0,r.jsx)(ex,{scrollRef:U,infoMessage:n,messages:S,isRecording:O,onRecordClick:z,onStopClick:()=>{F(),w(),g.current=!1,d(!1),B(),A(),M()},isExpanded:a,expandButtonClick:()=>i(!a),initialChatMessage:S.length?"":"Hold the button to record a voice message",recordingHandlers:{onMouseDown:q,onMouseUp:J,onMouseLeave:J,onTouchStart:Y,onTouchEnd:K,onTouchCancel:K},children:e=>"assistant"===e.role&&"audio"===e.type?(0,r.jsx)(_.sv,{ref:t=>{t&&E(e.id,t)},src:e.objectUrl,controls:!0},e.id):"text"===e.type?(0,r.jsx)(_.cM,{role:e.role,children:e.content},e.id):void 0})},eN=()=>{let e=(0,l.useSearchParams)().get("mode");return"realtime"===e?(0,r.jsx)(ev,{}):"voice"===e?(0,r.jsx)(eS,{}):null},eP=e=>{let{className:t}=e,n=(0,l.useRouter)();(0,l.useSearchParams)().get("mode");let s=(0,A.r8)(),o=(0,h.Ym)();return(0,r.jsx)("section",{id:"chat-container",className:(0,c.A)(i().section,t),children:(0,r.jsx)(u.mc,{children:(0,r.jsxs)("div",{className:i().demoContainer,children:[(0,r.jsx)("button",{className:i().closeButton,onClick:()=>n.push((0,g.c)(m.J.homePage,o)),type:"button",children:"\xd7"}),(0,r.jsxs)(u.xA,{children:[(0,r.jsxs)("div",{className:i().demoContent,children:[(0,r.jsxs)("div",{className:i().demoHeader,children:[(0,r.jsx)("h1",{className:i().demoTitle,children:"Start conversation right now"}),!s&&(0,r.jsx)("p",{className:i().demoDescription,children:"1 minute demo conversation free, no registration"})]}),(0,r.jsx)(v,{}),(0,r.jsx)(eN,{}),(0,r.jsx)("p",{className:i().helpText,children:"Choose a mode to start communication"})]}),(0,r.jsx)("div",{className:i().demoImage,children:(0,r.jsx)(d.y,{})})]})]})})})};eP.displayName="CombinedChatComponent";let ew=e=>(0,r.jsx)(o.Suspense,{fallback:(0,r.jsx)("div",{children:"Loading..."}),children:(0,r.jsx)(eP,{...e})});ew.displayName="CombinedChatComponentWrapper"},30412:e=>{e.exports={action_buttons:"VoiceMessagesChatUI_action_buttons__APf0G",record_button:"VoiceMessagesChatUI_record_button__bUNNd"}},31628:e=>{e.exports={modal:"s_modal__gpWQu"}},40012:e=>{e.exports={chatContainer:"ChatContainer_chatContainer__pCqLx",footer_slot:"ChatContainer_footer_slot__pEzeo"}},44627:e=>{e.exports={micButton:"MicButton_micButton__Mtt3n",pulse:"MicButton_pulse__HA4P6",active:"MicButton_active__Z25BT","pulse-active":"MicButton_pulse-active___7AyL"}},49780:e=>{e.exports={section:"CombinedChatComponent_section___Gzy4",demoContainer:"CombinedChatComponent_demoContainer__R97_2",closeButton:"CombinedChatComponent_closeButton__ilJXv",demoContent:"CombinedChatComponent_demoContent__vVU8Z",demoHeader:"CombinedChatComponent_demoHeader__uvaMq",demoTitle:"CombinedChatComponent_demoTitle__ngVvD",demoDescription:"CombinedChatComponent_demoDescription__9RdWx",modeSelector:"CombinedChatComponent_modeSelector__5dSRl",modeTab:"CombinedChatComponent_modeTab__mUx2M",active:"CombinedChatComponent_active___Y40F",realtimeInterface:"CombinedChatComponent_realtimeInterface__CZmkg",chatLog:"CombinedChatComponent_chatLog__hESuO",emptyState:"CombinedChatComponent_emptyState__6YPYu",message:"CombinedChatComponent_message__9e5Op",user:"CombinedChatComponent_user__VaKKn",assistant:"CombinedChatComponent_assistant__EgC5j",voiceInterface:"CombinedChatComponent_voiceInterface__goddA",voiceControls:"CombinedChatComponent_voiceControls__mcLZo",recordButton:"CombinedChatComponent_recordButton__2JfMr",helpText:"CombinedChatComponent_helpText__MV0yf",demoImage:"CombinedChatComponent_demoImage__8R8O6",imageCard:"CombinedChatComponent_imageCard__bgbIQ",characterImage:"CombinedChatComponent_characterImage__31g_H"}},55548:()=>{},57423:e=>{e.exports={page:"AuthPage_page__8HF7Q",authSection:"AuthPage_authSection__L4pr4",authContainer:"AuthPage_authContainer___bodD",authCard:"AuthPage_authCard__AnGmi",authForm:"AuthPage_authForm__4MOyS",authHeader:"AuthPage_authHeader__B4tr0",authTitle:"AuthPage_authTitle__3QOYw",authDescription:"AuthPage_authDescription__ilxV3",form:"AuthPage_form__PQkN4",inputGroup:"AuthPage_inputGroup__trMjf",input:"AuthPage_input__PJzNI",submitButton:"AuthPage_submitButton__cv2tl",switchButton:"AuthPage_switchButton__ljbEC",forgotPassword:"AuthPage_forgotPassword__CAFDY",forgotLink:"AuthPage_forgotLink__vvYlF",divider:"AuthPage_divider__Brqzu",errorMessage:"AuthPage_errorMessage__zy6Tn",successMessage:"AuthPage_successMessage__M8wtI",socialButtons:"AuthPage_socialButtons__XqWfX",socialButton:"AuthPage_socialButton__9WDzr",socialIcon:"AuthPage_socialIcon__8WSrv"}},65793:(e,t,n)=>{Promise.resolve().then(n.t.bind(n,52619,23)),Promise.resolve().then(n.bind(n,4810)),Promise.resolve().then(n.bind(n,93034)),Promise.resolve().then(n.bind(n,38402)),Promise.resolve().then(n.bind(n,83876)),Promise.resolve().then(n.bind(n,45224)),Promise.resolve().then(n.bind(n,47810)),Promise.resolve().then(n.bind(n,71981)),Promise.resolve().then(n.bind(n,89228)),Promise.resolve().then(n.bind(n,96018)),Promise.resolve().then(n.bind(n,92242)),Promise.resolve().then(n.bind(n,57602)),Promise.resolve().then(n.bind(n,51264)),Promise.resolve().then(n.bind(n,56388)),Promise.resolve().then(n.bind(n,99534)),Promise.resolve().then(n.bind(n,53962)),Promise.resolve().then(n.bind(n,55302)),Promise.resolve().then(n.bind(n,3076)),Promise.resolve().then(n.bind(n,21042)),Promise.resolve().then(n.bind(n,67693)),Promise.resolve().then(n.bind(n,26366)),Promise.resolve().then(n.bind(n,84155)),Promise.resolve().then(n.bind(n,91562)),Promise.resolve().then(n.bind(n,55637)),Promise.resolve().then(n.bind(n,87721)),Promise.resolve().then(n.bind(n,40933)),Promise.resolve().then(n.bind(n,59877)),Promise.resolve().then(n.bind(n,49051)),Promise.resolve().then(n.bind(n,41534)),Promise.resolve().then(n.bind(n,42135)),Promise.resolve().then(n.bind(n,3785)),Promise.resolve().then(n.bind(n,74443)),Promise.resolve().then(n.bind(n,49478)),Promise.resolve().then(n.bind(n,36497))},79244:e=>{e.exports={modeSelector:"ChangeChatMode_modeSelector__dfvy1",modeTab:"ChangeChatMode_modeTab__KFMNb",active:"ChangeChatMode_active__Wn7tw"}}}]);